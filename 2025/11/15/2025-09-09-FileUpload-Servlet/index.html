<!DOCTYPE html><html lang="[&quot;en&quot;,&quot;vi&quot;,&quot;default&quot;]" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Java Servlet FileUpload Vulnerability | Phat Mai Blog</title><meta name="author" content="Phat Mai"><meta name="copyright" content="Phat Mai"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Java Servlet FileUpload Vulnerability by @PhatmhLỗ hổng File UploadBản chất của File Upload: File Upload đối với tôi nó đơn giản chỉ là lợidụng Unsafe Method để truyền một Untrusted Data vào nhằm thay">
<meta property="og:type" content="article">
<meta property="og:title" content="Java Servlet FileUpload Vulnerability">
<meta property="og:url" content="https://pzhat.github.io/2025/11/15/2025-09-09-FileUpload-Servlet/index.html">
<meta property="og:site_name" content="Phat Mai Blog">
<meta property="og:description" content="Java Servlet FileUpload Vulnerability by @PhatmhLỗ hổng File UploadBản chất của File Upload: File Upload đối với tôi nó đơn giản chỉ là lợidụng Unsafe Method để truyền một Untrusted Data vào nhằm thay">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://pzhat.github.io/img/avatar.jpg">
<meta property="article:published_time" content="2025-11-14T19:34:38.210Z">
<meta property="article:modified_time" content="2025-10-24T05:38:35.000Z">
<meta property="article:author" content="Phat Mai">
<meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pzhat.github.io/img/avatar.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Java Servlet FileUpload Vulnerability",
  "url": "https://pzhat.github.io/2025/11/15/2025-09-09-FileUpload-Servlet/",
  "image": "https://pzhat.github.io/img/avatar.jpg",
  "datePublished": "2025-11-14T19:34:38.210Z",
  "dateModified": "2025-10-24T05:38:35.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Phat Mai",
      "url": "https://pzhat.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://pzhat.github.io/2025/11/15/2025-09-09-FileUpload-Servlet/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.4/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Java Servlet FileUpload Vulnerability',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/mobile-cover-fix.css"><meta name="generator" content="Hexo 8.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/background2.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/cover.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Phat Mai Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Java Servlet FileUpload Vulnerability</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Java Servlet FileUpload Vulnerability</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-11-14T19:34:38.210Z" title="Created 2025-11-15 02:34:38">2025-11-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-10-24T05:38:35.000Z" title="Updated 2025-10-24 12:38:35">2025-10-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pentesting/">pentesting</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pentesting/Web-Exploitation/">Web-Exploitation</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Java-Servlet-FileUpload-Vulnerability-by-Phatmh"><a href="#Java-Servlet-FileUpload-Vulnerability-by-Phatmh" class="headerlink" title="Java Servlet FileUpload Vulnerability by @Phatmh"></a>Java Servlet FileUpload Vulnerability by @Phatmh</h1><h3 id="Lo-hong-File-Upload"><a href="#Lo-hong-File-Upload" class="headerlink" title="Lỗ hổng File Upload"></a>Lỗ hổng File Upload</h3><p>Bản chất của File Upload: File Upload đối với tôi nó đơn giản chỉ là lợi<br>dụng Unsafe Method để truyền một Untrusted Data vào nhằm thay đổi hành<br>vi của hệ thống trong trường hợp này là Web App, với FileUpload những gì<br>User Upload lên sẽ chính là Untrusted Data và với Feature Upload File<br>như này sẽ thế nào nếu nó không được Validate một cách cẩn thận ta sẽ<br>đến với DEMO bằng Java Servlet.</p>
<h3 id="Web-App-Overview"><a href="#Web-App-Overview" class="headerlink" title="Web App Overview"></a>Web App Overview</h3><p>Đây là một Web App được dựng với mục đích như một môi trường test các<br>case phổ biến về lỗ hổng FileUpload. Feature chính của nó bao gồm:</p>
<ol>
  <li>Upload File</li>
  <li>View File</li>
  <li>Delete File</li>
</ol>

<p><img src="https://hackmd.io/_uploads/rJPNUzWwxx.png" alt="image"> </p>
<p>Hình ảnh overview<br>của trang web. Và ở đây mình code theo từng level, mỗi level tương ứng<br>với mỗi cơ chế validate khác nhau và ở đây ta sẽ phải tìm các Bypass và<br>đi đên RCE. </p>
<p><img src="https://hackmd.io/_uploads/rJQiLfbPll.png" alt="image"></p>
<h3 id="Di-vao-phan-tich-code"><a href="#Di-vao-phan-tich-code" class="headerlink" title="Đi vào phân tích code"></a>Đi vào phân tích code</h3><p><img src="https://hackmd.io/_uploads/BJVQ5Mbvxg.png" alt="image"> </p>
<p>Ở đây mình dùng<br><code>@WebServlet</code> để ánh xạ path của web chứa chức năng file upload đến<br>index.jsp vì ở đây mình làm trang web chứa nhiều lỗ hổng nên việc chia<br>ra từng alias là một ứng dụng rất cần thiết. Rồi đến với đoạn code đầu<br>tiên của class thì ta có đoạn <code>getUploadPath</code> đoạn này để define thư mục<br>mà mình sẽ Upload File lên cụ thể ở đây các file sẽ nằm ở <code>/upload</code>.</p>
<p><img src="https://hackmd.io/_uploads/SyKPiG-Ple.png" alt="image"> </p>
<p>Đoạn code doGet()<br>trong Servlet này dùng để xử lý các request HTTP GET gửi tới endpoint<br>hello-file-upload. Đây là phần quan trọng của chức năng quản lý file<br>upload, bao gồm cả việc tạo thư mục upload nếu chưa có và xoá file nếu<br>có yêu cầu.</p>
<pre><code>response.setContentType(&quot;text/html&quot;);
PrintWriter out = response.getWriter();
</code></pre>
<ul>
<li>Dòng này thiết lập định dạng của response là text&#x2F;html, tức là nội<br>dung trả về là HTML.</li>
<li>PrintWriter out cho phép bạn ghi dữ liệu HTML vào response để hiển<br>thị trên trình duyệt.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">if</span> (!uploadDir.exists()) uploadDir.mkdir();</span><br><span class="line"></span><br><span class="line">-   Kiểm tra nếu thư mục upload chưa tồn tại thì tạo thư mục mới.</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">    <span class="type">String</span> <span class="variable">deleteFile</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;delete&quot;</span>);</span><br><span class="line"></span><br><span class="line">-   Lấy giá trị của query parameter delete từ URL.</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">if</span> (deleteFile != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">fileToDelete</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(uploadPath, deleteFile);</span><br><span class="line">        <span class="keyword">if</span> (fileToDelete.exists()) &#123;</span><br><span class="line">            fileToDelete.delete();</span><br><span class="line">            response.sendRedirect(<span class="string">&quot;hello-file-upload&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            out.println(<span class="string">&quot;&lt;p style=&#x27;color:red;&#x27;&gt;File not found.&lt;/p&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">-   Xoá file nếu tồn tại.</span><br><span class="line">-   ![image](https:<span class="comment">//hackmd.io/_uploads/ryCj6z-Pex.png) Đoạn HTML để</span></span><br><span class="line">    render ra được các chức năng.</span><br><span class="line"></span><br><span class="line">![image](https:<span class="comment">//hackmd.io/_uploads/Sk6gAMbPxl.png) Hiển thị tất cả file</span></span><br><span class="line">trong thư mục upload dưới dạng danh sách HTML. Mỗi file có <span class="number">2</span> tùy chọn: -</span><br><span class="line">View: mở file trong tab mới. - Delete: gửi request để xóa file.</span><br><span class="line"></span><br><span class="line">    File[] files = uploadDir.listFiles();</span><br><span class="line"></span><br><span class="line">-   Lấy toàn bộ file trong thư mục <span class="title function_">upload</span> <span class="params">(đã được tạo và gán ở phần</span></span><br><span class="line"><span class="params">    trước)</span>.</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">if</span> (files != <span class="literal">null</span> &amp;&amp; files.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        out.println(<span class="string">&quot;&lt;ul&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (File f : files) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">fname</span> <span class="operator">=</span> f.getName();</span><br><span class="line"></span><br><span class="line">-   Nếu thư mục không rỗng, duyệt từng file để in ra dưới dạng danh sách</span><br><span class="line">    `(&lt;ul&gt; và &lt;li&gt;)`</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    out.println(<span class="string">&quot;&lt;li&gt;&quot;</span> + fname +</span><br><span class="line">        <span class="string">&quot; [&lt;a href=&#x27;&quot;</span> + request.getContextPath() + <span class="string">&quot;/upload/&quot;</span> + fname + <span class="string">&quot;&#x27; target=&#x27;_blank&#x27;&gt;View&lt;/a&gt;] &quot;</span> +</span><br><span class="line">        <span class="string">&quot;[&lt;a href=&#x27;?delete=&quot;</span> + fname + <span class="string">&quot;&#x27; onclick=&#x27;return confirm(\&quot;Delete &quot;</span> + fname + <span class="string">&quot;?\&quot;)&#x27;&gt;Delete&lt;/a&gt;]&lt;/li&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">-   Tạo link View và Delete.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        out.println(<span class="string">&quot;No uploaded files.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">-   Nếu thư mục rỗng (không có file), in ra thông báo <span class="string">&quot;No uploaded</span></span><br><span class="line"><span class="string">    files.&quot;</span></span><br><span class="line"></span><br><span class="line">![image](https:<span class="comment">//hackmd.io/_uploads/S1zhNmbDel.png)</span></span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">uploadPath</span> <span class="operator">=</span> getUploadPath(request);</span><br><span class="line">    <span class="type">File</span> <span class="variable">uploadDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(uploadPath);</span><br><span class="line">    <span class="keyword">if</span> (!uploadDir.exists()) uploadDir.mkdir();</span><br><span class="line"></span><br><span class="line">-   Tạo thư mục upload nếu chưa có</span><br><span class="line">-   getUploadPath(request) trả về đường dẫn thư mục upload trên server.</span><br><span class="line">-   <span class="type">File</span> <span class="variable">uploadDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(uploadPath) tạo đối tượng File để thao</span><br><span class="line">    tác.</span><br><span class="line">-   mkdir() tạo thư mục nếu chưa tồn tại.</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    <span class="type">String</span> <span class="variable">selectedCase</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;case&quot;</span>);</span><br><span class="line"></span><br><span class="line">-   Lấy giá trị của tham số <span class="keyword">case</span> trong form upload.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    <span class="type">Part</span> <span class="variable">filePart</span> <span class="operator">=</span> request.getPart(<span class="string">&quot;file&quot;</span>);</span><br><span class="line"></span><br><span class="line">-   filePart là đối tượng chứa toàn bộ dữ liệu file được upload.</span><br><span class="line">-   request.getPart(<span class="string">&quot;file&quot;</span>) dựa vào tên input trong HTML form:</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> filePart.getSubmittedFileName();</span><br><span class="line"></span><br><span class="line">-   Lấy tên file gốc.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InputStream</span> <span class="variable">fileContent</span> <span class="operator">=</span> filePart.getInputStream();</span><br></pre></td></tr></table></figure>
<ul>
<li>Lấy nội dung của File.</li>
</ul>
<h3 id="Di-vao-phan-tich-cac-case-loi"><a href="#Di-vao-phan-tich-cac-case-loi" class="headerlink" title="Đi vào phân tích các case lỗi"></a>Đi vào phân tích các case lỗi</h3><h4 id="Case1-FileUpload-Without-Validation"><a href="#Case1-FileUpload-Without-Validation" class="headerlink" title="Case1 : FileUpload Without Validation"></a>Case1 : FileUpload Without Validation</h4><p><img src="https://hackmd.io/_uploads/HkoT87bPgg.png" alt="image"> </p>
<p>Với case đầu tiên<br>thì nó chỉ đơn giản là một chức năng Upload File nhưng không hề có một<br>lớp phòng thủ nào vì thế attacker sẽ có thể dễ dàng thực hiện Upload một<br>file thực thi nguy hiểm để RCE được WebApp.<br><img src="https://hackmd.io/_uploads/SJKdvQWPxg.png" alt="image"><br>Chọn Lv1 là no<br>filter. </p>
<p><img src="https://hackmd.io/_uploads/SkSqvXbwgx.png" alt="image"> </p>
<p>Thử Upload<br>lên một file <code>.txt</code> </p>
<p><img src="https://hackmd.io/_uploads/HJX2vQ-Peg.png" alt="image"></p>
<p>Test thử chức năng view file, có thể thấy rằng các file được upload lên<br>sẽ nằm ở thư mục<code>/upload</code>. Với case này thì rõ ràng là nó không hề có<br>một lớp filter nào vậy nên việc Upload Shell sẽ khá là đơn giản.</p>
<p><img src="https://hackmd.io/_uploads/BJoI_7bPll.png" alt="image"> </p>
<p>Viết một File<br>shell.jsp với nội dung như trên.</p>
<p><img src="https://hackmd.io/_uploads/SJX9_Q-Dgx.png" alt="image"> </p>
<p>Tiến hành Upload<br>shell.jsp lên và nó sẽ nằm ở thư mục <code>/upload</code>.</p>
<p><code>http://localhost:1337/vulnerability_web_war_exploded/upload/shell.jsp?cmd=whoami</code></p>
<p>Tiến hành truyền câu lệnh vào query <code>?cmd</code> ở đây tôi dùng <code>whoami</code> và đã<br>thành công thực thi câu lệnh RCE</p>
<p><img src="https://hackmd.io/_uploads/HyWQKmWPlx.png" alt="image"></p>
<h4 id="Case-2-First-Dot-Split"><a href="#Case-2-First-Dot-Split" class="headerlink" title="Case 2 : First Dot Split"></a>Case 2 : First Dot Split</h4><p><img src="https://hackmd.io/_uploads/SkOOKQWPge.png" alt="image"></p>
<pre><code>String[] parts = filename.split(&quot;\\.&quot;);
</code></pre>
<p>Tách tên file bằng dấu “.”. Ví dụ: - “webshell.jsp” → [“webshell”,<br>“jsp”] - “webshell.jsp.jpg” → [“webshell”, “jsp”, “jpg”] -<br>split(“\.”) dùng \. vì . là ký tự đặc biệt trong regex.</p>
<pre><code>String ext2 = parts.length &gt; 1 ? parts[1].toLowerCase() : &quot;&quot;;
</code></pre>
<ul>
<li>Lấy phần mở rộng thứ 2, tức là index 1 Và lỗi đã xảy ra ở đây, lớp<br>filter này chỉ có thể hoạt động trong trường hợp file mình upload<br>lên chỉ có 1 dấu <code>.</code> trong trường hợp này ta hoàn toàn có thể dễ<br>dàng Bypass bằng cách lợi dụng hành vi chỉ nhận dấu chấm đầu tiên<br>bằng cách tạo 1 file có tên <code>shell.jpg.jsp</code> thì ở đây sau dấu chấm<br>đầu tiên nó sẽ nhận định đây là file jpg nên sẽ đi qua lớp filter dễ<br>dàng. <img src="https://hackmd.io/_uploads/SJFRAXbwgg.png" alt="image"> Chọn case<br>2 và Upload thử file shell.jsp và đã bị dính filter.<br><img src="https://hackmd.io/_uploads/S17My4WPlx.png" alt="image"> Thay đổi tên<br>file bằng cách thêm 1 extension là <code>.jpg</code> phía trước là file đã<br>thành <code>shell.jpg.jsp</code> và response trả về là 302 chứng tỏ file đã<br>được upload thành công.<br><img src="https://hackmd.io/_uploads/HyeDkNZDgg.png" alt="image"> File shell thực<br>thi đã xuất hiện trong &#x2F;upload.<br><img src="https://hackmd.io/_uploads/ry0q1NWweg.png" alt="image"> Thành công RCE<br>với câu lệnh whoami trả về kết quả như trên.</li>
</ul>
<h4 id="Case-3-Last-Dot-Check"><a href="#Case-3-Last-Dot-Check" class="headerlink" title="Case 3 : Last Dot Check"></a>Case 3 : Last Dot Check</h4><p><img src="https://hackmd.io/_uploads/BkYGlEZDll.png" alt="image"> </p>
<p>Chọn case 3, lúc này<br>file shell trước đã được xóa để tránh nhầm lẫn.</p>
<p><img src="https://hackmd.io/_uploads/SJerxVZDxx.png" alt="image"></p>
<pre><code>String ext3 = filename.substring(filename.lastIndexOf(&#39;.&#39;) + 1).toLowerCase();
</code></pre>
<ul>
<li><p>lastIndexOf(‘.’): tìm vị trí dấu chấm cuối cùng trong tên file.</p>
</li>
<li><p>substring(…): lấy tất cả ký tự sau dấu chấm đó → chính là đuôi<br>file thực tế.</p>
</li>
<li><p>toLowerCase(): chuẩn hóa chữ thường để không bị bypass bởi JSP. Tại<br>đây có thể thấy rằng lớp filter đã khá là cứng rồi vì nó sẽ check ở<br>dấu chấm cuối cùng cho nên nếu ta test theo các case trước sẽ không<br>còn tác dụng nữa. Vậy mindset ở đây là liệu ngoài jsp ra thì mặc<br>định nó còn thực thi file nào khác nữa không? Sau một lúc tìm hiểu<br>thì ta có thể Bypass được bằng file <code>jspx</code> vì lớp filter chỉ bắt mỗi<br><code>jsp</code>. </p>
<p><img src="https://hackmd.io/_uploads/Bkt7NEWvxl.png" alt="image"> </p>
<p>Thành<br>công đi qua lớp filter này bằng cách lợi dụng sự bất cẩn của dev ghi<br>chặn nhưng không hết các đuôi file có thể thực thi. Ở đây sau khi<br>tìm hiểu thì tomcat sẽ hiểu định dạng <code>jspx</code> là jsp xml vậy nên ta<br>cần sửa lại một chút trong file shell.jspx</p>
<p><img src="https://hackmd.io/_uploads/B1jdH4-wle.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/SJLsSNWvgl.png" alt="image"> </p>
<p>Thành công RCE<br>được. </p>
<p><img src="https://hackmd.io/_uploads/HyzvmLEWDll.png" alt="image"></p>
</li>
</ul>
<h4 id="Case-4-JSP-Block-Only"><a href="#Case-4-JSP-Block-Only" class="headerlink" title="Case 4 : JSP Block Only"></a>Case 4 : JSP Block Only</h4><p><img src="https://hackmd.io/_uploads/BJA6L4Wwee.png" alt="image"> </p>
<p>Đến với case này thì<br>nó vẫn là kiểm tra chỉ cần có tồn tại jsp ở cuối filename là sẽ dính<br>filter nhưng mà cũng như ở case 3 ta có thể tìm kiếm file khác ngoài jsp<br>có thể thực thi như <code>jspx</code> đã được test ở bên trên. Tính ra case 3 ở đây<br>khá giống case 4 nhưng nếu như nó chặn hẳn jsp và jspx thì vẫn sẽ có<br>cách Bypass nhưng với điều kiện là tùy vào config của Web App, với tùy<br>trường hợp config ta có thể sử dụng. Nhưng ở đây có một case dễ khả thi<br>là sử dụng dấu <code>.</code> lợi dụng config up một file <code>shell.jsp.</code> lên, dựa<br>theo tìm hiểu về config của tomcat thì nó vẫn sẽ nhận là file jsp nếu<br>không được config cẩn thận thì có thể lợi dụng nó.</p>
<p><img src="https://hackmd.io/_uploads/rkWvcEZwll.png" alt="image"> </p>
<p>Test thử<br><code>shell.jsp.</code> và thành công upload lên.</p>
<p><img src="https://hackmd.io/_uploads/BklFcVWwgx.png" alt="image"> </p>
<p>Trong danh sách đã<br>hiển thị các thư mục được upload và có file shell nằm trong đó.</p>
<p><img src="https://hackmd.io/_uploads/BklhqNbvgl.png" alt="image"> </p>
<p>Thành công lợi dụng<br>config để upload RCE.</p>
<h4 id="Case-5-Content-Type-Filter"><a href="#Case-5-Content-Type-Filter" class="headerlink" title="Case 5 : Content-Type Filter"></a>Case 5 : Content-Type Filter</h4><p><img src="https://hackmd.io/_uploads/H1MBiVZDxg.png" alt="image"> </p>
<p>Ở đây server chỉ<br>kiểm tra Content-Type trong phần header của file upload, chứ không kiểm<br>tra extension hoặc nội dung thực tế của file vậy nên có thể Bypass dễ<br>dàng bằng cách khiến nó hiểu rằng File thực thi là một File hoặc bất kì<br>file nào mà nó allow.</p>
<p><img src="https://hackmd.io/_uploads/HkmCiNbwlg.png" alt="image"> </p>
<p>Mod lại content type<br>thành <code>image/png</code> </p>
<p><img src="https://hackmd.io/_uploads/HkCx34Zwgx.png" alt="image"></p>
<p>Thành công bypass qua lớp filter bằng cách lừa đây là một file image.</p>
<p><img src="https://hackmd.io/_uploads/B1u72V-Pgg.png" alt="image"> </p>
<p>File shell.jsp đã có<br>giờ ta chỉ cần RCE như các case trên.</p>
<h4 id="Case-6-Magic-Bytes-Check"><a href="#Case-6-Magic-Bytes-Check" class="headerlink" title="Case 6 : Magic Bytes Check"></a>Case 6 : Magic Bytes Check</h4><p><img src="https://hackmd.io/_uploads/HJy4T4bDgl.png" alt="image"> </p>
<ul>
<li>89504E47 là magic<br>bytes chuẩn của file PNG (<code>\x</code>{&#x3D;tex}89PNG) - Đoạn code này sẽ check 4<br>bytes đầu để kiểm tra file được đưa lên có phải là file PNG không nếu<br>không thì sẽ bị chặn. Nhưng ở đây cho dù check được vào trong magic byte<br>nhưng vẫn chưa đủ để validate hết vì ta hoàn toàn có thể trick được hệ<br>thống bằng cách bỏ thêm đoạn <code>\x89PNG</code> vào trước các dòng payload để khi<br>nó đọc sẽ nhận định đây chính là file PNG vì nó chỉ nhận 4 bytes đầu.</li>
</ul>
<p><img src="https://hackmd.io/_uploads/SyYEyrZwgl.png" alt="image"> </p>
<p>Tạo một file<br>shell.jsp bằng linux.</p>
<p><img src="https://hackmd.io/_uploads/SyAu1rbPgg.png" alt="image"> </p>
<p>Tạo một file<br>fake.jsp đưa magic byte vào đó để nó sẽ nhận là image sau đó ghép với<br>file shell.jsp bây giờ nội dung shell.jsp sẽ được đưa vào fake.jsp mà<br>magic byte của fake.jsp được giữ nguyên.</p>
<p><img src="https://hackmd.io/_uploads/S1lbgS-vxl.png" alt="image"> </p>
<p>Kiểm tra lại nội<br>dung fake.jsp. </p>
<p><img src="https://hackmd.io/_uploads/ByJwlSbwxg.png" alt="image"> </p>
<p>Tiến<br>hành upload và upload thành công.</p>
<p><img src="https://hackmd.io/_uploads/B1RuxHZveg.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/SkkoxSbDge.png" alt="image"> </p>
<p>Thành công RCE.</p>
<h4 id="Case-7-Path-Traversal-FileUpload-To-RCE"><a href="#Case-7-Path-Traversal-FileUpload-To-RCE" class="headerlink" title="Case 7 : Path Traversal + FileUpload To RCE"></a>Case 7 : Path Traversal + FileUpload To RCE</h4><p><img src="https://hackmd.io/_uploads/r1YKWB-Dle.png" alt="image"> </p>
<p>Ở case này thì cũng<br>không có filter vì ở đây mình muốn mô phỏng tình huống là tại thư mục<br>upload nó sẽ được config là không cho phép run bất kì file thực thi nào,<br>vậy nếu rơi vào trường hợp đó thì có cách Path Traversal là có thể lợi<br>dụng được vì ta có thể thử với thư mục khác liệu thư mục đó có thực thi<br>được các file thực thi hay không.</p>
<p><img src="https://hackmd.io/_uploads/S1c7GHbvxe.png" alt="image"> </p>
<p>Tiến hành upload thử<br><code>../shell.jsp</code> và có thể thấy file đã được upload lên nhưng liệu nó có<br>đi ra khỏi thư mục &#x2F;upload không.</p>
<p><img src="https://hackmd.io/_uploads/By7PfBZwlg.png" alt="image"> </p>
<p>Check ở bên trong<br>cấu trúc thư mục thì có thể thấy rằng file shell.jsp đã thoát ra khỏi<br>thư mục upload. </p>
<p><img src="https://hackmd.io/_uploads/S1xcMBZDel.png" alt="image"> </p>
<p> Kiểm<br>tra trong này thì nó kêu chưa có thư mục được upload và củng cố được<br>rằng file shell đã được upload ra ngoài thư mục cha. Bây giờ chỉ cần<br>truy cập đến và tiến hành RCE thôi.</p>
<h4 id="Com-them"><a href="#Com-them" class="headerlink" title="Cơm thêm"></a>Cơm thêm</h4><p>Có vẻ như lỗi FileUpload ta còn có thể khai thác thêm một lỗi nữa là<br>Store XSS vì ở các Level có lớp filter check extension có vẻ như nó<br>không hề chặn file <code>.html</code>. Trình duyệt thực thi được script trong file<br>.html sau khi upload là vì server không cài đặt Content-Disposition:<br>attachment, và MIME type của file là text&#x2F;html, nên trình duyệt xử lý<br>file như một trang web. Đầu tiên tạo một file xss.html với nội dung:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    alert(1);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Tiến hành Upload thử file lên.<br><img src="https://hackmd.io/_uploads/rkw4jWzPel.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/ry8Bibfvge.png" alt="image"> </p>
<p>Thành công Upload<br>File <code>xss.html</code> lên bây giờ nếu ta là user bình thường bấm thử view thì<br>nó sẽ trả về như thế nào.</p>
<p><img src="https://hackmd.io/_uploads/BymFs-GDgg.png" alt="image"> </p>
<p>Có thể thấy xss đã<br>được thực thi tại trường hợp này thì file đã được lưu và nếu user click<br>vào xem nó sẽ thực thi XSS và nó là store XSS, ở đây web này tôi không<br>khởi tạo session id nên không thể DEMO được XSS để lấy cắp cookie bằng<br>fetch và Webhook được.</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://pzhat.github.io">Phat Mai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://pzhat.github.io/2025/11/15/2025-09-09-FileUpload-Servlet/">https://pzhat.github.io/2025/11/15/2025-09-09-FileUpload-Servlet/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Web/">Web</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/11/15/2025-09-09-Cookie-Arena-Cmdi/" title="Cookie Arena Challenges WU (@Phatmh)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Cookie Arena Challenges WU (@Phatmh)</div></div><div class="info-2"><div class="info-item-1">Cookie Arena Web Challenges WriteUp by (@Phatmh)NSLookup (Level 1)Đây là một Website có chức năng là nslookup sử dụng hàm shell_exec của php để thực thi. Ta tiến hành truy cập để xem giao diện của web app.Ở đây ta thấy nó khá là basic khi chỉ có duy nhất một nơi có chức năng nslookup và bên cạnh là source code cho sẵn của chall, ta sẽ tiến hành phân tích source code được cấp sẵn. Ở ngay đầu tiên ta gặp khởi tạo và include file design và tạo object ($design) có tên là NSLookup Tool. Đến với nh...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-09-CanteenFood-CTF-Challenge-WriteUp/" title="CanteenFood CTF Challenge WriteUp"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">CanteenFood CTF Challenge WriteUp</div></div><div class="info-2"><div class="info-item-1">CanteenFood CTF Challenge WriteUp by @PhatmhTiến hành phân tích chức năng theo kiểu BlackBox Đây là một trang Web có chức năng cho User tìm kiếm được món ăn phù hợp với túi tiền của mình nhất bằng cách nhập số tiền mình mong muốn nó sẽ trả về món mà mình đủ tiền trả.  Ở đây sau khi viết ra số 300 và tiến hành bấm chức năng thì nó trả về được list các món dưới 300.  Ở ngay bên trên mình phát hiện được một nơi đáng ngờ là chữ admin có thể dẫn ta đi đâu đó vì thể click thử vào.  Nó trả về cho ta...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/11/15/2025-09-09-CanteenFood-CTF-Challenge-WriteUp/" title="CanteenFood CTF Challenge WriteUp"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">CanteenFood CTF Challenge WriteUp</div></div><div class="info-2"><div class="info-item-1">CanteenFood CTF Challenge WriteUp by @PhatmhTiến hành phân tích chức năng theo kiểu BlackBox Đây là một trang Web có chức năng cho User tìm kiếm được món ăn phù hợp với túi tiền của mình nhất bằng cách nhập số tiền mình mong muốn nó sẽ trả về món mà mình đủ tiền trả.  Ở đây sau khi viết ra số 300 và tiến hành bấm chức năng thì nó trả về được list các món dưới 300.  Ở ngay bên trên mình phát hiện được một nơi đáng ngờ là chữ admin có thể dẫn ta đi đâu đó vì thể click thử vào.  Nó trả về cho ta...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-09-Servlet-Sql-Injection/" title="Java Servlet Sql Injection Vulnerability by @Phatmh"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">Java Servlet Sql Injection Vulnerability by @Phatmh</div></div><div class="info-2"><div class="info-item-1">Java Servlet Sql Injection Vulnerability by @PhatmhTổng quan cấu trúc file java123456789101112131415161718192021222324252627282930313233343536373839+---.idea   +---dataSources+---.mvn   +---wrapper+---src   +---main      +---java         +---sql_injection             +---controller             +---dao             +---model             +---util      +---resources         +---META-INF      +---webapp          +---WEB-INF   +---test       +---java       +---resources+---target    +---classes    ...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-09-Servlet-Cmdi/" title="Java Servlet Command Injection Vulnerability Challenges"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">Java Servlet Command Injection Vulnerability Challenges</div></div><div class="info-2"><div class="info-item-1">Java Servlet Command Injection Vulnerability ChallengesCấu trúc Project Cấu trúc Project   1234567891011121314151617181920212223242526272829303132333435+---.idea+---.mvnª   +---wrapper+---srcª   +---mainª   ª   +---javaª   ª   ª   +---ciª   ª   ª       +---controllerª   ª   ª       +---serviceª   ª   ª       +---utilª   ª   +---resourcesª   ª   ª   +---META-INFª   ª   +---webappª   ª       +---WEB-INFª   +---testª       +---javaª       +---resources+---target    +---classes    ª   +---ci    ª...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-17-SecCon-SafeUpload-Web-Challenge/" title="CyberCon 2025 SafeUpload Web Challenge"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">CyberCon 2025 SafeUpload Web Challenge</div></div><div class="info-2"><div class="info-item-1">CyberCon 2025 SafeUpload Web ChallengeTổng quan challenge Mở challenge lên thì ta thấy nó cấp cho ta một giao diện dùng để upload file nên nghi ngờ ban đầu sẽ là web này dính lỗ hổng file upload. Tiến hành thử upload lên file php với nội dung: 123&lt;?phpecho &quot;test&quot;;?&gt;   Có vẻ như đã dính filter của bài có thể thấy nó đã xoá đi file mình upload lên, bây giờ ta thử upload 1 file php nhưng không có nội dung.  Vẫn là file đó nhưng không có nội dung thì hoàn toàn có thể upload bình t...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-16-WebSec.fr-level28/" title="WebSec.fr Level 28 CTF challenge"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">WebSec.fr Level 28 CTF challenge</div></div><div class="info-2"><div class="info-item-1">WebSec.fr Level 28 CTF challengeTổng quan: 1234567891011121314151617181920212223&lt;?phpif(isset($_POST[&#x27;submit&#x27;])) &#123;  if ($_FILES[&#x27;flag_file&#x27;][&#x27;size&#x27;] &gt; 4096) &#123;    die(&#x27;Your file is too heavy.&#x27;);  &#125;  $filename = &#x27;./tmp/&#x27; . md5($_SERVER[&#x27;REMOTE_ADDR&#x27;]) . &#x27;.php&#x27;;  $fp = fopen($_FILES[&#x27;flag_file&#x27;][&#x27;tmp_name&#x27;], &#x27;r&#x27;);  $flagfilecontent = fread($fp, filesize($_FILES[&#x27;flag_file...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-09-Cookie-Arena-Cmdi/" title="Cookie Arena Challenges WU (@Phatmh)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">Cookie Arena Challenges WU (@Phatmh)</div></div><div class="info-2"><div class="info-item-1">Cookie Arena Web Challenges WriteUp by (@Phatmh)NSLookup (Level 1)Đây là một Website có chức năng là nslookup sử dụng hàm shell_exec của php để thực thi. Ta tiến hành truy cập để xem giao diện của web app.Ở đây ta thấy nó khá là basic khi chỉ có duy nhất một nơi có chức năng nslookup và bên cạnh là source code cho sẵn của chall, ta sẽ tiến hành phân tích source code được cấp sẵn. Ở ngay đầu tiên ta gặp khởi tạo và include file design và tạo object ($design) có tên là NSLookup Tool. Đến với nh...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Phat Mai</div><div class="author-info-description">Pentester/Redteam</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/pzhat"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/pzhat" target="_blank" title="GitHub"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/phat-mai-hong-2580a52aa/" target="_blank" title="LinkedIn"><i class="fab fa-linkedin" style="color: #0A66C2;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Blog about cybersecurity, hacking, pentesting, red teaming and more...</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Java-Servlet-FileUpload-Vulnerability-by-Phatmh"><span class="toc-number">1.</span> <span class="toc-text">Java Servlet FileUpload Vulnerability by @Phatmh</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Lo-hong-File-Upload"><span class="toc-number">1.1.</span> <span class="toc-text">Lỗ hổng File Upload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-App-Overview"><span class="toc-number">1.2.</span> <span class="toc-text">Web App Overview</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Di-vao-phan-tich-code"><span class="toc-number">1.3.</span> <span class="toc-text">Đi vào phân tích code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Di-vao-phan-tich-cac-case-loi"><span class="toc-number">1.4.</span> <span class="toc-text">Đi vào phân tích các case lỗi</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Case1-FileUpload-Without-Validation"><span class="toc-number">1.4.1.</span> <span class="toc-text">Case1 : FileUpload Without Validation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Case-2-First-Dot-Split"><span class="toc-number">1.4.2.</span> <span class="toc-text">Case 2 : First Dot Split</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Case-3-Last-Dot-Check"><span class="toc-number">1.4.3.</span> <span class="toc-text">Case 3 : Last Dot Check</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Case-4-JSP-Block-Only"><span class="toc-number">1.4.4.</span> <span class="toc-text">Case 4 : JSP Block Only</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Case-5-Content-Type-Filter"><span class="toc-number">1.4.5.</span> <span class="toc-text">Case 5 : Content-Type Filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Case-6-Magic-Bytes-Check"><span class="toc-number">1.4.6.</span> <span class="toc-text">Case 6 : Magic Bytes Check</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Case-7-Path-Traversal-FileUpload-To-RCE"><span class="toc-number">1.4.7.</span> <span class="toc-text">Case 7 : Path Traversal + FileUpload To RCE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Com-them"><span class="toc-number">1.4.8.</span> <span class="toc-text">Cơm thêm</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/25/2025-11-25-GraphQL-API-Vulnerability/" title="GraphQL API Vulnerability">GraphQL API Vulnerability</a><time datetime="2025-11-24T21:38:11.491Z" title="Created 2025-11-25 04:38:11">2025-11-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/16/2025-11-16-CORS-PortSwigger/" title="PortSwigger CORS (Cross-Origin Resource Sharing) challenge WriteUp">PortSwigger CORS (Cross-Origin Resource Sharing) challenge WriteUp</a><time datetime="2025-11-16T09:11:55.936Z" title="Created 2025-11-16 16:11:55">2025-11-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/15/2025-11-03-I.redteam-Kerberoasting/" title="Ired.Team Kerberoasting (Credential Access)">Ired.Team Kerberoasting (Credential Access)</a><time datetime="2025-11-14T19:34:38.244Z" title="Created 2025-11-15 02:34:38">2025-11-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/15/2025-11-04-THM-Basic-Pentesting/" title="Tryhackme Basic Pentesting Challenge">Tryhackme Basic Pentesting Challenge</a><time datetime="2025-11-14T19:34:38.244Z" title="Created 2025-11-15 02:34:38">2025-11-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/15/2025-11-07-I.redteam-Kerberos-Golden-Ticket/" title="Ired.Team Kerberos Golden Tickets Lab">Ired.Team Kerberos Golden Tickets Lab</a><time datetime="2025-11-14T19:34:38.244Z" title="Created 2025-11-15 02:34:38">2025-11-15</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Phat Mai</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.4/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="/"></script></div></body></html>